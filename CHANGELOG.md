# 更新日誌

本文件記錄了 HiveMind 分布式運算平台的所有重要變更。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，
並且本項目遵循 [語義化版本](https://semver.org/lang/zh-TW/)。

## [Unreleased]

### 進行中的開發
- AI 模型分割功能完整實現
- BT 模組與主系統整合
- Web 界面實時監控功能
- 多語言支援 (英文、日文)
- 測試框架建立

### 計畫變更
- 改進節點信任等級評估算法
- 優化 gRPC 通信性能
- 重構任務調度機制
- 建立完整的測試體系

## [0.1.0] - 2025-08-14

### 實際完成的功能
- 基本的節點池管理系統
  - 節點註冊和狀態管理
  - 基於信用評分的信任等級劃分
  - Redis 數據存儲
- 用戶管理系統
  - 用戶註冊和登入
  - JWT 身份驗證
  - 電子郵件驗證整合
- 基本的任務分配機制
  - 任務上傳和下載
  - 基本的資源監控
- gRPC 通信架構
  - 節點間通信協議
  - Protocol Buffers 定義
- Web 管理界面
  - 基本的控制面板
  - 節點狀態監控

### 技術架構
- **後端**: Python 3.8+, Flask, gRPC
- **數據存儲**: SQLite (用戶數據), Redis (節點狀態)
- **通信**: gRPC + Protocol Buffers
- **容器化**: Docker (Worker 節點)
- **身份驗證**: JWT + 電子郵件驗證

### 已知限制
- 缺少測試框架
- GPU 監控功能需要額外依賴 (pynvml)
- Docker Compose 配置尚未提供
- 生產環境部署指南需要完善
  - 實時節點狀態監控
  - 任務執行進度視覺化
  - 用戶餘額和交易記錄查詢
- VPN 安全通信
  - WireGuard 自動配置生成
  - 節點間加密隧道管理
- 完整的文檔體系
  - API 接口文檔
  - 部署指南
  - 故障排除手冊
  - 開發者指南

### 變更
- 🔄 優化 gRPC 性能，減少 30% 平均響應時間
- 🔄 改進錯誤處理機制，增加詳細的錯誤碼和描述
- 🔄 重新設計數據庫結構，提高查詢效率
- 🔄 統一日誌格式，便於集中管理和分析

### 修復
- 修復並發節點註冊時的競態條件問題
- 解決 VPN 配置生成失敗的問題
- 修復任務結果文件清理機制
- 解決 Redis 連接池洩漏問題

### 安全性
- 加強 JWT 令牌安全性，添加定期刷新機制
- 實現輸入驗證和清理，防止注入攻擊
- 添加 API 速率限制，防止濫用

## [1.1.0] - 2023-12-01

### 新增
- CPT 代幣經濟系統
  - 用戶間代幣轉帳功能
  - 基於貢獻度的自動獎勵分發
  - 餘額查詢和交易記錄
- 電子郵件驗證系統
  - 集成 Resend API 進行郵件發送
  - 註冊成功獎勵 100 CPT 代幣
- Docker 容器化任務執行
  - 安全的任務隔離環境
  - 資源使用限制和監控
- 節點健康監控
  - 30 秒心跳檢測機制
  - 自動故障節點標記和恢復

### 變更
- 🔄 從 SQLite 遷移到支援 PostgreSQL
- 🔄 重構用戶認證系統，改用 JWT
- 🔄 優化任務分配算法，考慮節點地理位置

### 修復
- 修復節點斷線重連問題
- 解決任務超時處理邏輯錯誤
- 修復 Redis 數據不一致問題

## [1.0.0] - 2023-11-01

### 新增
- 基礎分布式架構
  - Node Pool 資源調度中心
  - Master 主控節點管理
  - Worker 工作節點執行
- gRPC 通信協議
  - 高效的節點間通信
  - Protocol Buffers 數據格式
- 基礎任務管理
  - 任務創建和分發
  - 結果收集和回傳
- 用戶管理系統
  - 用戶註冊和登入
  - 基本身份驗證
- Web 管理界面
  - Flask 基礎框架
  - 節點狀態查看
  - 任務提交界面

### 技術基礎
- Python 3.8+ 運行環境
- Redis 數據存儲
- SQLite 用戶數據管理
- Docker 容器支援

## [0.9.0] - 2023-10-15 (Beta)

### 新增
- 原型系統驗證
- 基礎節點註冊功能
- 簡單任務執行機制

### 已知問題
- 節點故障恢復機制不完善
- 安全性驗證尚未完成
- 性能優化待改進

## [0.1.0] - 2023-09-01 (Alpha)

### 新增
- 項目初始化
- 基礎代碼框架
- 開發環境搭建

---

## 圖例說明

- 新功能
- 🔄 變更
- 問題修復  
- 安全性改進
- 已知問題
- 文檔更新
- 基礎設施
- 性能改進
- 界面改進

## 版本發布週期

- **主要版本 (Major)**: 每 6-12 個月，包含重大功能變更
- **次要版本 (Minor)**: 每 2-3 個月，添加新功能和改進
- **修補版本 (Patch)**: 每 2-4 週，修復問題和小改進

## 版本支援政策

- **最新版本**: 完整支援和更新
- **前一個主要版本**: 安全更新和關鍵問題修復
- **更早版本**: 僅提供安全更新

## 升級指南

### 從 v1.1.x 升級到 v1.2.x

1. **備份數據**
   ```bash
   # 備份用戶數據和配置
   cp users.db users.db.backup
   cp .env .env.backup
   ```

2. **更新代碼**
   ```bash
   git pull origin main
   pip install -r requirements.txt
   ```

3. **數據庫遷移**
   ```bash
   python node_pool/database_migration.py
   ```

4. **配置更新**
   - 添加新的環境變數 (見 [部署指南](docs/DEPLOYMENT.md))
   - 更新 VPN 配置設置

5. **服務重啟**
   ```bash
   sudo systemctl restart hivemind-node-pool
   sudo systemctl restart hivemind-master
   ```

### 從 v1.0.x 升級到 v1.1.x

1. **重要**: 此版本包含資料庫結構變更
2. **備份**: 務必在升級前備份所有數據
3. **遷移**: 運行資料庫遷移腳本
4. **配置**: 更新環境變數和配置文件

## 重大變更通知

### v1.2.0
- **VPN 配置變更**: 新的 WireGuard 配置格式，舊配置需要重新生成
- **API 變更**: 部分 gRPC 接口參數有調整，請參考 [API 文檔](docs/API.md)

### v1.1.0  
- **資料庫結構變更**: 用戶表添加新字段，需要運行遷移腳本
- **認證機制變更**: 從基礎認證遷移到 JWT，舊令牌將失效

### v1.0.0
- **初始穩定版本**: 確立了主要 API 和架構設計

---

有關詳細的技術變更和 API 更新，請參考：
- [API 文檔](docs/API.md)
- [開發者指南](docs/DEVELOPER.md)
- [部署指南](docs/DEPLOYMENT.md)
