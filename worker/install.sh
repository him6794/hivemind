#!/bin/bash
set -e
echo '📁 建立資料夾 hivemind_worker/templates...'
mkdir -p hivemind_worker/templates
cd hivemind_worker
echo '🔧 建立 ./worker_node.py ...'
base64 -d > "./worker_node.py" << 'EOF_worker_node.py'
ZnJvbSBkb2NrZXIgaW1wb3J0IGZyb21fZW52CmZyb20gZG9ja2VyLmVycm9ycyBpbXBvcnQgSW1hZ2VOb3RGb3VuZCwgQVBJRXJyb3IKaW1wb3J0IGdycGMKZnJvbSB0aHJlYWRpbmcgaW1wb3J0IFRocmVhZCwgRXZlbnQsIExvY2sKZnJvbSBsb2dnaW5nIGltcG9ydCBiYXNpY0NvbmZpZywgaW5mbywgd2FybmluZywgZXJyb3IsIGNyaXRpY2FsLCBJTkZPLCBXQVJOSU5HLCBFUlJPUiwgZ2V0TGV2ZWxOYW1lCmZyb20gZmxhc2sgaW1wb3J0IEZsYXNrLCBqc29uaWZ5LCByZXF1ZXN0LCByZW5kZXJfdGVtcGxhdGUsIHNlc3Npb24sIHJlZGlyZWN0LCB1cmxfZm9yCmltcG9ydCBub2RlcG9vbF9wYjIKaW1wb3J0IG5vZGVwb29sX3BiMl9ncnBjCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKZnJvbSBvcyBpbXBvcnQgZW52aXJvbiwgbWFrZWRpcnMsIGNobW9kLCB3YWxrLCBfZXhpdCwgc3lzdGVtCmZyb20gb3MucGF0aCBpbXBvcnQgam9pbiwgZGlybmFtZSwgYWJzcGF0aCwgZXhpc3RzLCByZWxwYXRoCmZyb20gcHN1dGlsIGltcG9ydCBjcHVfY291bnQsIHZpcnR1YWxfbWVtb3J5LCBjcHVfcGVyY2VudApmcm9tIHRpbWUgaW1wb3J0IHRpbWUsIHNsZWVwCmZyb20gemlwZmlsZSBpbXBvcnQgWmlwRmlsZSwgWklQX0RFRkxBVEVECmZyb20gaW8gaW1wb3J0IEJ5dGVzSU8KZnJvbSBzeXMgaW1wb3J0IGV4aXQKZnJvbSB0ZW1wZmlsZSBpbXBvcnQgbWtkdGVtcApmcm9tIHN1YnByb2Nlc3MgaW1wb3J0IHJ1bgpmcm9tIHBsYXRmb3JtIGltcG9ydCBub2RlLCBzeXN0ZW0KIyDlj6rlnKggV2luZG93cyDljK/lhaUgQ1JFQVRFX05PX1dJTkRPVwp0cnk6CiAgICBmcm9tIHN1YnByb2Nlc3MgaW1wb3J0IENSRUFURV9OT19XSU5ET1cKZXhjZXB0IEltcG9ydEVycm9yOgogICAgQ1JFQVRFX05PX1dJTkRPVyA9IE5vbmUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YQpmcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleApmcm9tIHNodXRpbCBpbXBvcnQgY29weTIsIHJtdHJlZQpmcm9tIHNvY2tldCBpbXBvcnQgc29ja2V0LCBBRl9JTkVULCBTT0NLX0RHUkFNCmZyb20gdXVpZCBpbXBvcnQgdXVpZDQKZnJvbSB3ZWJicm93c2VyIGltcG9ydCBvcGVuIGFzIHdlYl9vcGVuCmZyb20gbmV0aWZhY2VzIGltcG9ydCBpbnRlcmZhY2VzLCBpZmFkZHJlc3NlcywgQUZfSU5FVApmcm9tIHJlcXVlc3RzIGltcG9ydCBwb3N0LCBnZXQsIGV4Y2VwdGlvbnMKYmFzaWNDb25maWcobGV2ZWw9SU5GTywgZm9ybWF0PSclKGFzY3RpbWUpcyAtICUobGV2ZWxuYW1lKXMgLSBbJSh0aHJlYWROYW1lKXNdIC0gJShtZXNzYWdlKXMnKQoKTk9ERV9QT1JUID0gaW50KGVudmlyb24uZ2V0KCJOT0RFX1BPUlQiLCA1MDA1MykpCkZMQVNLX1BPUlQgPSBpbnQoZW52aXJvbi5nZXQoIkZMQVNLX1BPUlQiLCA1MDAwKSkKTUFTVEVSX0FERFJFU1MgPSBlbnZpcm9uLmdldCgiTUFTVEVSX0FERFJFU1MiLCAiMTAuMC4wLjE6NTAwNTEiKQpOT0RFX0lEID0gZW52aXJvbi5nZXQoIk5PREVfSUQiLCBmIndvcmtlci17bm9kZSgpLnNwbGl0KCcuJylbMF19LXtOT0RFX1BPUlR9IikKCmNsYXNzIFdvcmtlck5vZGU6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5ub2RlX2lkID0gTk9ERV9JRAogICAgICAgIHNlbGYucG9ydCA9IE5PREVfUE9SVAogICAgICAgIHNlbGYubWFzdGVyX2FkZHJlc3MgPSBNQVNURVJfQUREUkVTUwogICAgICAgIHNlbGYuZmxhc2tfcG9ydCA9IEZMQVNLX1BPUlQKCiAgICAgICAgIyDni4DmhYvnrqHnkIYKICAgICAgICBzZWxmLnN0YXR1cyA9ICJJbml0aWFsaXppbmciCiAgICAgICAgc2VsZi5jdXJyZW50X3Rhc2tfaWQgPSBOb25lCiAgICAgICAgc2VsZi51c2VybmFtZSA9IE5vbmUKICAgICAgICBzZWxmLnRva2VuID0gTm9uZQogICAgICAgIHNlbGYuaXNfcmVnaXN0ZXJlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5sb2dpbl90aW1lID0gTm9uZQogICAgICAgIHNlbGYuY3B0X2JhbGFuY2UgPSAwCgogICAgICAgICMg57ea56iL5o6n5Yi2CiAgICAgICAgc2VsZi5zdGF0dXNfdGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYuX3N0b3BfZXZlbnQgPSBFdmVudCgpCiAgICAgICAgc2VsZi5sb2dzID0gW10KICAgICAgICBzZWxmLmxvZ19sb2NrID0gTG9jaygpCgogICAgICAgICMg55So5oi25pyD6Kmx566h55CGCiAgICAgICAgc2VsZi51c2VyX3Nlc3Npb25zID0ge30KICAgICAgICBzZWxmLnNlc3Npb25fbG9jayA9IExvY2soKQogICAgICAgIHNlbGYuX3N0b3BfY3VycmVudF90YXNrID0gRmFsc2UKCiAgICAgICAgIyDlhYjoh6rli5XpgKPnt5ogVlBOCiAgICAgICAgc2VsZi5fYXV0b19qb2luX3ZwbigpCgogICAgICAgICMg56Gs6auU5L+h5oGvCiAgICAgICAgc2VsZi5faW5pdF9oYXJkd2FyZSgpCiAgICAgICAgIyBEb2NrZXIg5Yid5aeL5YyWCiAgICAgICAgc2VsZi5faW5pdF9kb2NrZXIoKQogICAgICAgICMgZ1JQQyDpgKPmjqUKICAgICAgICBzZWxmLl9pbml0X2dycGMoKQogICAgICAgICMgRmxhc2sg5oeJ55SoCiAgICAgICAgc2VsZi5faW5pdF9mbGFzaygpCiAgICAgICAgc2VsZi5zdGF0dXMgPSAiV2FpdGluZyBmb3IgTG9naW4iCgogICAgZGVmIF9hdXRvX2pvaW5fdnBuKHNlbGYpOgogICAgICAgICIiIuiHquWLleiri+axguS4u+aOp+erryAvYXBpL3Zwbi9qb2luIOWPluW+lyBXaXJlR3VhcmQg6YWN572u5Lim6YCj57eaIFZQTiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgYXBpX3VybCA9ICJodHRwczovL2hpdmVtaW5kLmp1c3RpbjA3MTEuY29tL2FwaS92cG4vam9pbiIKICAgICAgICAgICAgY2xpZW50X25hbWUgPSBzZWxmLm5vZGVfaWQKICAgICAgICAgICAgcmVzcCA9IHBvc3QoYXBpX3VybCwganNvbj17ImNsaWVudF9uYW1lIjogY2xpZW50X25hbWV9LCB0aW1lb3V0PTE1LCB2ZXJpZnk9VHJ1ZSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzcF9qc29uID0gcmVzcC5qc29uKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJlc3BfanNvbiA9IHt9CiAgICAgICAgICAgIGlmIHJlc3Auc3RhdHVzX2NvZGUgPT0gMjAwIGFuZCByZXNwX2pzb24uZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgICAgICBjb25maWdfY29udGVudCA9IHJlc3BfanNvbi5nZXQoImNvbmZpZyIpCiAgICAgICAgICAgICAgICBjb25maWdfcGF0aCA9IGpvaW4oZGlybmFtZShhYnNwYXRoKF9fZmlsZV9fKSksICJ3ZzAuY29uZiIpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19wYXRoLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY29uZmlnX2NvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi6Ieq5YuV5Y+W5b6XIFdpcmVHdWFyZCDphY3nva7kuKblr6vlhaUge2NvbmZpZ19wYXRofSIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi5a+r5YWlIFdpcmVHdWFyZCDphY3nva7lpLHmlZc6IHtlfSIsIFdBUk5JTkcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAjIFdpbmRvd3MvTGludXgg6YO95Zyo55W25YmN55uu6YyE5Z+36KGMIHdnLXF1aWNr77yM6ZyA5pyJ5qyK6ZmQ6IiH6Lev5b6RCiAgICAgICAgICAgICAgICBmcm9tIG9zIGltcG9ydCBzeXN0ZW0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN5c3RlbShmIndnLXF1aWNrIGRvd24ge2NvbmZpZ19wYXRofSAyPi9kZXYvbnVsbDsgd2ctcXVpY2sgdXAge2NvbmZpZ19wYXRofSIpCiAgICAgICAgICAgICAgICBpZiByZXN1bHQgPT0gMDoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coIldpcmVHdWFyZCBWUE4g5ZWf5YuV5oiQ5YqfIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKCJXaXJlR3VhcmQgVlBOIOWVn+WLleWkseaVl++8jOiri+aqouafpeasiumZkOiIh+mFjee9riIsIFdBUk5JTkcpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcHJvbXB0X21hbnVhbF92cG4oY29uZmlnX3BhdGgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXNwX2pzb24uZ2V0KCJlcnJvciIpIGlmIHJlc3BfanNvbiBlbHNlIHJlc3AudGV4dAogICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi6Ieq5YuV5Y+W5b6XIFdpcmVHdWFyZCDphY3nva7lpLHmlZc6IHtlcnJvcl9tc2d9IiwgV0FSTklORykKICAgICAgICAgICAgICAgIGlmIGVycm9yX21zZyBhbmQgIlZQTiDmnI3li5nkuI3lj6/nlKgiIGluIGVycm9yX21zZzoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coIuiri+eiuuiqjeS4u+aOp+erryBGbGFzayDllZ/li5XmmYLmnInmraPnorrliJ3lp4vljJYgV2lyZUd1YXJkU2VydmVy77yM5LiUIC9hcGkvdnBuL2pvaW4g5Y+v55SoIiwgV0FSTklORykKICAgICAgICAgICAgICAgIHNlbGYuX3Byb21wdF9tYW51YWxfdnBuKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuX2xvZyhmIuiHquWLleiri+axgiAvYXBpL3Zwbi9qb2luIOWkseaVlzoge2V9IiwgV0FSTklORykKICAgICAgICAgICAgc2VsZi5fcHJvbXB0X21hbnVhbF92cG4oKQoKICAgIGRlZiBfcHJvbXB0X21hbnVhbF92cG4oc2VsZiwgY29uZmlnX3BhdGg9Tm9uZSk6CiAgICAgICAgIiIi5o+Q56S655So5oi25omL5YuV6YCj57eaIFdpcmVHdWFyZCIiIgogICAgICAgIG1zZyA9ICgKICAgICAgICAgICAgIlxuW+aPkOekul0g6Ieq5YuV6YCj57eaIFdpcmVHdWFyZCDlpLHmlZfvvIzoq4vmiYvli5XpgKPnt5ogVlBO77yaXG4iCiAgICAgICAgICAgICIxLiDoq4vmib7liLDmgqjnmoToqK3lrprmqpQod2cwLmNvbmYp44CCXG4iCiAgICAgICAgICAgICIyLiDmiYvli5XmiZPplot3aXJlZ3VhcmTlrqLmiLbnq6/lsI7lhaXphY3nva5cbiIKICAgICAgICAgICAgIjMuIOWmgumBh+asiumZkOWVj+mhjOiri+eUqOeuoeeQhuWToS9Sb290IOasiumZkOWft+ihjOOAglxuIgogICAgICAgICkKICAgICAgICBwcmludChtc2cpCiAgICAgICAgcHJpbnQoJ+WmguaenOaCqOW3sue2k+mAo+e3muWlveiri+aMiXknKQogICAgICAgIGEgPSBpbnB1dCgpCiAgICAgICAgaWYgYSA9PSAneSc6CiAgICAgICAgICAgIHNlbGYuX2xvZygi55So5oi25bey56K66KqN5omL5YuV6YCj57eaIFdpcmVHdWFyZCIpCgogICAgZGVmIF9pbml0X2hhcmR3YXJlKHNlbGYpOgogICAgICAgICIiIuWIneWni+WMluehrOmrlOS/oeaBryIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5ob3N0bmFtZSA9IG5vZGUoKQogICAgICAgICAgICBzZWxmLmNwdV9jb3JlcyA9IGNwdV9jb3VudChsb2dpY2FsPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOS9v+eUqOWPr+eUqOiomOaGtumrlOiAjOS4jeaYr+e4veiomOaGtumrlAogICAgICAgICAgICBtZW1vcnlfaW5mbyA9IHZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAgICAgc2VsZi5tZW1vcnlfZ2IgPSByb3VuZChtZW1vcnlfaW5mby5hdmFpbGFibGUgLyAoMTAyNCoqMyksIDIpCiAgICAgICAgICAgIHNlbGYudG90YWxfbWVtb3J5X2diID0gcm91bmQobWVtb3J5X2luZm8udG90YWwgLyAoMTAyNCoqMyksIDIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOiHquWLleaqoua4rOWcsOWNgO+8jOS4jemAsuihjOeUqOaItuS6pOS6kgogICAgICAgICAgICBzZWxmLmxvY2F0aW9uID0gc2VsZi5fYXV0b19kZXRlY3RfbG9jYXRpb24oKSBvciAiVW5rbm93biIKICAgICAgICAgICAgCiAgICAgICAgICAgICMg542y5Y+W5pys5qmfIElQCiAgICAgICAgICAgIHNlbGYubG9jYWxfaXAgPSBzZWxmLl9nZXRfbG9jYWxfaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnsKHljJbnmoTmlYjog73oqIjnrpcKICAgICAgICAgICAgc2VsZi5jcHVfc2NvcmUgPSBzZWxmLl9iZW5jaG1hcmtfY3B1KCkKICAgICAgICAgICAgc2VsZi5ncHVfc2NvcmUsIHNlbGYuZ3B1X25hbWUsIHNlbGYuZ3B1X21lbW9yeV9nYiA9IHNlbGYuX2RldGVjdF9ncHUoKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5fbG9nKGYiSGFyZHdhcmU6IENQVT17c2VsZi5jcHVfY29yZXN9IGNvcmVzLCBSQU09e3NlbGYubWVtb3J5X2diOi4xZn1HQiBhdmFpbGFibGUgKFRvdGFsOiB7c2VsZi50b3RhbF9tZW1vcnlfZ2I6LjFmfUdCKSIpCiAgICAgICAgICAgIHNlbGYuX2xvZyhmIlBlcmZvcm1hbmNlOiBDUFU9e3NlbGYuY3B1X3Njb3JlfSwgR1BVPXtzZWxmLmdwdV9zY29yZX0iKQogICAgICAgICAgICBzZWxmLl9sb2coZiJMb2NhdGlvbjoge3NlbGYubG9jYXRpb259IikKICAgICAgICAgICAgc2VsZi5fbG9nKGYiTG9jYWwgSVA6IHtzZWxmLmxvY2FsX2lwfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLl9sb2coZiJIYXJkd2FyZSBkZXRlY3Rpb24gZmFpbGVkOiB7ZX0iLCBFUlJPUikKICAgICAgICAgICAgIyDoqK3nva7poJDoqK3lgLwKICAgICAgICAgICAgc2VsZi5ob3N0bmFtZSA9ICJ1bmtub3duIgogICAgICAgICAgICBzZWxmLmNwdV9jb3JlcyA9IDEKICAgICAgICAgICAgc2VsZi5tZW1vcnlfZ2IgPSAxLjAKICAgICAgICAgICAgc2VsZi50b3RhbF9tZW1vcnlfZ2IgPSAxLjAKICAgICAgICAgICAgc2VsZi5sb2NhdGlvbiA9ICJVbmtub3duIgogICAgICAgICAgICBzZWxmLmxvY2FsX2lwID0gIjEyNy4wLjAuMSIKICAgICAgICAgICAgc2VsZi5jcHVfc2NvcmUgPSAwCiAgICAgICAgICAgIHNlbGYuZ3B1X3Njb3JlID0gMAogICAgICAgICAgICBzZWxmLmdwdV9uYW1lID0gIk5vdCBEZXRlY3RlZCIKICAgICAgICAgICAgc2VsZi5ncHVfbWVtb3J5X2diID0gMC4wCgogICAgZGVmIF9hdXRvX2RldGVjdF9sb2NhdGlvbihzZWxmKToKICAgICAgICAiIiLpnZzpu5joh6rli5XmqqLmuKzlnLDljYAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg5L2/55So5aSa5YCLIEFQSSDlmJfoqabmqqLmuKwKICAgICAgICAgICAgYXBpcyA9IFsKICAgICAgICAgICAgICAgICdodHRwOi8vaXAtYXBpLmNvbS9qc29uLycsCiAgICAgICAgICAgICAgICAnaHR0cHM6Ly9pcGFwaS5jby9qc29uLycsCiAgICAgICAgICAgICAgICAnaHR0cDovL3d3dy5nZW9wbHVnaW4ubmV0L2pzb24uZ3AnCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBhcGlfdXJsIGluIGFwaXM6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBnZXQoYXBpX3VybCwgdGltZW91dD01KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmoLnmk5rkuI3lkIwgQVBJIOeahOmfv+aHieagvOW8j+iZleeQhgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW5lbnQgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnkgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29udGluZW50JyBpbiBkYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGluZW50ID0gZGF0YS5nZXQoJ2NvbnRpbmVudCcsICcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGRhdGEuZ2V0KCdjb3VudHJ5JywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJ2NvbnRpbmVudF9jb2RlJyBpbiBkYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGluZW50X2NvZGVzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBUyc6ICdBc2lhJywgJ0FGJzogJ0FmcmljYScsICdOQSc6ICdOb3J0aCBBbWVyaWNhJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0EnOiAnU291dGggQW1lcmljYScsICdFVSc6ICdFdXJvcGUnLCAnT0MnOiAnT2NlYW5pYScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbmVudCA9IGNvbnRpbmVudF9jb2Rlcy5nZXQoZGF0YS5nZXQoJ2NvbnRpbmVudF9jb2RlJywgJycpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGRhdGEuZ2V0KCdjb3VudHJ5X25hbWUnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnZ2VvcGx1Z2luX2NvbnRpbmVudE5hbWUnIGluIGRhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW5lbnQgPSBkYXRhLmdldCgnZ2VvcGx1Z2luX2NvbnRpbmVudE5hbWUnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnkgPSBkYXRhLmdldCgnZ2VvcGx1Z2luX2NvdW50cnlOYW1lJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBjb250aW5lbnQgYW5kIGNvdW50cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW5lbnRfbWFwcGluZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXNpYSc6ICfkup7mtLInLCAnQWZyaWNhJzogJ+mdnua0sicsICdOb3J0aCBBbWVyaWNhJzogJ+WMl+e+jicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NvdXRoIEFtZXJpY2EnOiAn5Y2X576OJywgJ0V1cm9wZSc6ICfmrZDmtLInLCAnT2NlYW5pYSc6ICflpKfmtIvmtLInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVjdGVkX3JlZ2lvbiA9IGNvbnRpbmVudF9tYXBwaW5nLmdldChjb250aW5lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXRlY3RlZF9yZWdpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi6Ieq5YuV5qqi5ris5Zyw5Y2AOiB7Y291bnRyeX0gLT4ge2RldGVjdGVkX3JlZ2lvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRlY3RlZF9yZWdpb24KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleGNlcHQgKGV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiwgRXhjZXB0aW9uKToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5fbG9nKCLlnLDljYDmqqLmuKzlpLHmlZfvvIzkvb/nlKggVW5rbm93biIpCiAgICAgICAgICAgIHJldHVybiAiVW5rbm93biIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuX2xvZyhmIuWcsOWNgOaqoua4rOmMr+iqpDoge2V9IikKICAgICAgICAgICAgcmV0dXJuICJVbmtub3duIgoKICAgIGRlZiBfZ2V0X2xvY2FsX2lwKHNlbGYpOgogICAgICAgICIiIueNsuWPluacrOapnyBJUCDlnLDlnYDvvIjlhKrlhYjkvb/nlKggV2lyZUd1YXJkIOe2suWNoe+8iSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyDmqqLmn6XmiYDmnInntrLljaHmjqXlj6MKICAgICAgICAgICAgaW50ZXJmYWNlc19saXN0ID0gaW50ZXJmYWNlcygpCiAgICAgICAgICAgIHNlbGYuX2xvZyhmIuaqoua4rOWIsOe2suWNoeaOpeWPozoge2ludGVyZmFjZXNfbGlzdH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDlhKrlhYjmqqLmn6UgV2lyZUd1YXJkIOebuOmXnOaOpeWPowogICAgICAgICAgICB3Z19pbnRlcmZhY2VzID0gW2lmYWNlIGZvciBpZmFjZSBpbiBpbnRlcmZhY2VzX2xpc3QgaWYgJ3dnJyBpbiBpZmFjZS5sb3dlcigpIG9yICd3aXJlZ3VhcmQnIGluIGlmYWNlLmxvd2VyKCldCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB3Z19pbnRlcmZhY2VzOgogICAgICAgICAgICAgICAgZm9yIHdnX2lmYWNlIGluIHdnX2ludGVyZmFjZXM6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBhZGRycyA9IGlmYWRkcmVzc2VzKHdnX2lmYWNlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBBRl9JTkVUIGluIGFkZHJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2dfaXAgPSBhZGRyc1tBRl9JTkVUXVswXVsnYWRkciddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiLmqqLmuKzliLAgV2lyZUd1YXJkIOe2suWNoSB7d2dfaWZhY2V977yMSVA6IHt3Z19pcH0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdnX2lwCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiLmqqLmn6Uge3dnX2lmYWNlfSDmjqXlj6PlpLHmlZc6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOaqouafpeaYr+WQpuaciSAxMC4wLjAueCDntrLmrrXnmoQgSVDvvIhWUE4g57ay5q6177yJCiAgICAgICAgICAgIGZvciBpZmFjZSBpbiBpbnRlcmZhY2VzX2xpc3Q6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYWRkcnMgPSBpZmFkZHJlc3NlcyhpZmFjZSkKICAgICAgICAgICAgICAgICAgICBpZiBBRl9JTkVUIGluIGFkZHJzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgYWRkcl9pbmZvIGluIGFkZHJzW0FGX0lORVRdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXAgPSBhZGRyX2luZm9bJ2FkZHInXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDmqqLmn6XmmK/lkKblnKggVlBOIOe2suautQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXAuc3RhcnRzd2l0aCgnMTAuMC4wLicpIGFuZCBpcCAhPSAnMTAuMC4wLjEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIuaqoua4rOWIsCBWUE4g57ay5q61IElQOiB7aXB9ICjmjqXlj6M6IHtpZmFjZX0pIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDlpoLmnpzmspLmnInmib7liLAgVlBOIElQ77yM5L2/55So6aCQ6Kit5pa55rOVCiAgICAgICAgICAgIHNlbGYuX2xvZygi5pyq5qqi5ris5YiwIFdpcmVHdWFyZCDntrLljaHvvIzkvb/nlKjpoJDoqK3ntrLljaEiKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuX2xvZyhmIue2suWNoeaqoua4rOWkseaVlzoge2V9IikKICAgICAgICAKICAgICAgICAjIOmgkOioreaWueazle+8mumAo+aOpeWklumDqOacjeWLmeeNsuWPluacrOapnyBJUAogICAgICAgIHRyeToKICAgICAgICAgICAgcyA9IHNvY2tldChBRl9JTkVULCBTT0NLX0RHUkFNKQogICAgICAgICAgICBzLmNvbm5lY3QoKCI4LjguOC44IiwgODApKQogICAgICAgICAgICBpcCA9IHMuZ2V0c29ja25hbWUoKVswXQogICAgICAgICAgICBzLmNsb3NlKCkKICAgICAgICAgICAgc2VsZi5fbG9nKGYi5L2/55So6aCQ6Kit5pa55rOV542y5Y+WIElQOiB7aXB9IikKICAgICAgICAgICAgcmV0dXJuIGlwCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBzZWxmLl9sb2coIuaJgOacieaWueazlemDveWkseaVl++8jOS9v+eUqCAxMjcuMC4wLjEiKQogICAgICAgICAgICByZXR1cm4gIjEyNy4wLjAuMSIKCiAgICBkZWYgdXBkYXRlX2xvY2F0aW9uKHNlbGYsIG5ld19sb2NhdGlvbik6CiAgICAgICAgIiIi5pu05paw56+A6bue5Zyw5Y2A6Kit5a6aIiIiCiAgICAgICAgYXZhaWxhYmxlX2xvY2F0aW9ucyA9IFsi5Lqe5rSyIiwgIumdnua0siIsICLljJfnvo4iLCAi5Y2X576OIiwgIuatkOa0siIsICLlpKfmtIvmtLIiLCAiVW5rbm93biJdCiAgICAgICAgCiAgICAgICAgaWYgbmV3X2xvY2F0aW9uIGluIGF2YWlsYWJsZV9sb2NhdGlvbnM6CiAgICAgICAgICAgIG9sZF9sb2NhdGlvbiA9IHNlbGYubG9jYXRpb24KICAgICAgICAgICAgc2VsZi5sb2NhdGlvbiA9IG5ld19sb2NhdGlvbgogICAgICAgICAgICBzZWxmLl9sb2coZiLlnLDljYDlt7Lmm7TmlrA6IHtvbGRfbG9jYXRpb259IC0+IHtuZXdfbG9jYXRpb259IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5aaC5p6c5bey6Ki75YaK77yM6ZyA6KaB6YeN5paw6Ki75YaK5Lul5pu05paw5Zyw5Y2A5L+h5oGvCiAgICAgICAgICAgIGlmIHNlbGYuaXNfcmVnaXN0ZXJlZCBhbmQgc2VsZi50b2tlbjoKICAgICAgICAgICAgICAgIHNlbGYuX3JlZ2lzdGVyKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlLCBmIuWcsOWNgOW3suabtOaWsOeCujoge25ld19sb2NhdGlvbn0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBmIueEoeaViOeahOWcsOWNgOmBuOaThzoge25ld19sb2NhdGlvbn0iCgogICAgZGVmIF9iZW5jaG1hcmtfY3B1KHNlbGYpOgogICAgICAgICIiIuewoeWMlueahCBDUFUg5Z+65rqW5ris6KmmIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZSgpCiAgICAgICAgICAgIHJlc3VsdCA9IDAKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMTBfMDAwXzAwMCk6CiAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0ICsgaSAqIGkpICUgOTg3NjU0MzIxCiAgICAgICAgICAgIGR1cmF0aW9uID0gdGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICByZXR1cm4gaW50KCgxMF8wMDBfMDAwIC8gZHVyYXRpb24pIC8gMTAwMCkgaWYgZHVyYXRpb24gPiAwLjAxIGVsc2UgMTAwMDAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiAxMDAwCgogICAgZGVmIF9kZXRlY3RfZ3B1KHNlbGYpOgogICAgICAgICIiIuewoeWMlueahCBHUFUg5qqi5risIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBzeXN0ZW0oKSA9PSAiV2luZG93cyI6CiAgICAgICAgICAgICAgICBjbWQgPSAnd21pYyBwYXRoIFdpbjMyX1ZpZGVvQ29udHJvbGxlciBnZXQgTmFtZSwgQWRhcHRlclJBTSAvVkFMVUUnCiAgICAgICAgICAgICAgICAjIOWDheWcqCBXaW5kb3dzIOS4i+WCs+mBniBjcmVhdGlvbmZsYWdzCiAgICAgICAgICAgICAgICByZXN1bHQgPSBydW4oY21kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRpb25mbGFncz1DUkVBVEVfTk9fV0lORE9XIGlmIENSRUFURV9OT19XSU5ET1cgZWxzZSAwKQogICAgICAgICAgICAgICAgb3V0cHV0ID0gcmVzdWx0LnN0ZG91dAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOino+aekOi8uOWHugogICAgICAgICAgICAgICAgbGluZXMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIG91dHB1dC5zcGxpdCgnXG4nKSBpZiAnPScgaW4gbGluZV0KICAgICAgICAgICAgICAgIGRhdGEgPSB7fQogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgICAgICAgICAgICAgaWYgJz0nIGluIGxpbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGtleSwgdmFsdWUgPSBsaW5lLnNwbGl0KCc9JywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtrZXkuc3RyaXAoKV0gPSB2YWx1ZS5zdHJpcCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdwdV9uYW1lID0gZGF0YS5nZXQoJ05hbWUnLCAnVW5rbm93bicpCiAgICAgICAgICAgICAgICByYW0gPSBkYXRhLmdldCgnQWRhcHRlclJBTScpCiAgICAgICAgICAgICAgICBncHVfbWVtb3J5X2diID0gcm91bmQoaW50KHJhbSkgLyAoMTAyNCoqMyksIDIpIGlmIHJhbSBhbmQgcmFtLmlzZGlnaXQoKSBlbHNlIDEuMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAnTWljcm9zb2Z0IEJhc2ljJyBub3QgaW4gZ3B1X25hbWU6CiAgICAgICAgICAgICAgICAgICAgZ3B1X3Njb3JlID0gNTAwICsgaW50KGdwdV9tZW1vcnlfZ2IgKiAyMDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdwdV9zY29yZSwgZ3B1X25hbWUsIGdwdV9tZW1vcnlfZ2IKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiAwLCAiTm90IERldGVjdGVkIiwgMC4wCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gMCwgIkRldGVjdGlvbiBGYWlsZWQiLCAwLjAKCiAgICBkZWYgX2luaXRfZG9ja2VyKHNlbGYpOgogICAgICAgICIiIuWIneWni+WMliBEb2NrZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuZG9ja2VyX2NsaWVudCA9IGZyb21fZW52KHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHNlbGYuZG9ja2VyX2NsaWVudC5waW5nKCkKICAgICAgICAgICAgc2VsZi5kb2NrZXJfYXZhaWxhYmxlID0gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmqqLmn6XmiJbmi4nlj5bpj6Hlg48KICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5kb2NrZXJfY2xpZW50LmltYWdlcy5nZXQoImp1c3RpbjMwOC9oaXZlbWluZC13b3JrZXI6bGF0ZXN0IikKICAgICAgICAgICAgICAgIHNlbGYuX2xvZygiRG9ja2VyIGltYWdlIGZvdW5kIikKICAgICAgICAgICAgZXhjZXB0IEltYWdlTm90Rm91bmQ6CiAgICAgICAgICAgICAgICBzZWxmLl9sb2coIkRvY2tlciBpbWFnZSBub3QgZm91bmQsIHB1bGxpbmcganVzdGluMzA4L2hpdmVtaW5kLXdvcmtlcjpsYXRlc3QiKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuZG9ja2VyX2NsaWVudC5pbWFnZXMucHVsbCgianVzdGluMzA4L2hpdmVtaW5kLXdvcmtlcjpsYXRlc3QiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZygiRG9ja2VyIGltYWdlIHB1bGxlZCBzdWNjZXNzZnVsbHkiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZhaWxlZCB0byBwdWxsIGRvY2tlciBpbWFnZToge2V9IiwgV0FSTklORykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuX2xvZyhmIkRvY2tlciBpbml0aWFsaXphdGlvbiBmYWlsZWQ6IHtlfSIsIFdBUk5JTkcpCiAgICAgICAgICAgIHNlbGYuZG9ja2VyX2F2YWlsYWJsZSA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuZG9ja2VyX2NsaWVudCA9IE5vbmUKCiAgICBkZWYgX2luaXRfZ3JwYyhzZWxmKToKICAgICAgICAiIiLliJ3lp4vljJYgZ1JQQyDpgKPmjqUiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuY2hhbm5lbCA9IGdycGMuaW5zZWN1cmVfY2hhbm5lbChzZWxmLm1hc3Rlcl9hZGRyZXNzKQogICAgICAgICAgICBncnBjLmNoYW5uZWxfcmVhZHlfZnV0dXJlKHNlbGYuY2hhbm5lbCkucmVzdWx0KHRpbWVvdXQ9MTApCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLnVzZXJfc3R1YiA9IG5vZGVwb29sX3BiMl9ncnBjLlVzZXJTZXJ2aWNlU3R1YihzZWxmLmNoYW5uZWwpCiAgICAgICAgICAgIHNlbGYubm9kZV9zdHViID0gbm9kZXBvb2xfcGIyX2dycGMuTm9kZU1hbmFnZXJTZXJ2aWNlU3R1YihzZWxmLmNoYW5uZWwpCiAgICAgICAgICAgIHNlbGYubWFzdGVyX3N0dWIgPSBub2RlcG9vbF9wYjJfZ3JwYy5NYXN0ZXJOb2RlU2VydmljZVN0dWIoc2VsZi5jaGFubmVsKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5fbG9nKGYiQ29ubmVjdGVkIHRvIG1hc3RlciBhdCB7c2VsZi5tYXN0ZXJfYWRkcmVzc30iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5fbG9nKGYiZ1JQQyBjb25uZWN0aW9uIGZhaWxlZDoge2V9IiwgRVJST1IpCgogICAgZGVmIF9pbml0X2ZsYXNrKHNlbGYpOgogICAgICAgICIiIuWIneWni+WMliBGbGFzayDmh4nnlKgiIiIKICAgICAgICBmcm9tIG9zLnBhdGggaW1wb3J0IGRpcm5hbWUsIGFic3BhdGgsIGpvaW4KICAgICAgICBiYXNlX2RpciA9IGRpcm5hbWUoYWJzcGF0aChfX2ZpbGVfXykpCiAgICAgICAgc2VsZi5hcHAgPSBGbGFzaygKICAgICAgICAgICAgX19uYW1lX18sCiAgICAgICAgICAgIHRlbXBsYXRlX2ZvbGRlcj1qb2luKGJhc2VfZGlyLCAidGVtcGxhdGVzIiksCiAgICAgICAgICAgIHN0YXRpY19mb2xkZXI9am9pbihiYXNlX2RpciwgInN0YXRpYyIpCiAgICAgICAgKQogICAgICAgIHNlbGYuYXBwLnNlY3JldF9rZXkgPSB0b2tlbl9oZXgoMzIpCiAgICAgICAgCiAgICAgICAgIyDphY3nva7mnIPoqbHmjIHkuYXmgKfvvIzkvb/nlKjkuI3lkIznmoRjb29raWXlkI3nqLHpgb/lhY3oiIfkuLvmjqfnq6/ooZ3nqoEKICAgICAgICBzZWxmLmFwcC5jb25maWcudXBkYXRlKAogICAgICAgICAgICBTRVNTSU9OX0NPT0tJRV9OQU1FPSd3b3JrZXJfc2Vzc2lvbicsICAjIOiIh+S4u+aOp+err+S4jeWQjOeahGNvb2tpZeWQjeeosQogICAgICAgICAgICBTRVNTSU9OX0NPT0tJRV9TRUNVUkU9RmFsc2UsICAjIOWmguaenOS9v+eUqEhUVFBT5YmH6Kit54K6VHJ1ZQogICAgICAgICAgICBTRVNTSU9OX0NPT0tJRV9IVFRQT05MWT1UcnVlLAogICAgICAgICAgICBTRVNTSU9OX0NPT0tJRV9TQU1FU0lURT0nTGF4JywKICAgICAgICAgICAgU0VTU0lPTl9DT09LSUVfUEFUSD0nLycsCiAgICAgICAgICAgIFNFU1NJT05fQ09PS0lFX0RPTUFJTj1Ob25lLAogICAgICAgICAgICBQRVJNQU5FTlRfU0VTU0lPTl9MSUZFVElNRT10aW1lZGVsdGEoaG91cnM9MjQpLCAgIyAyNOWwj+aZguacg+ipsQogICAgICAgICAgICBTRVNTSU9OX1JFRlJFU0hfRUFDSF9SRVFVRVNUPVRydWUgICMg5q+P5qyh6KuL5rGC5Yi35paw5pyD6KmxCiAgICAgICAgKQogICAgICAgIAogICAgICAgIHNlbGYuX3NldHVwX3JvdXRlcygpCiAgICAgICAgc2VsZi5fc3RhcnRfZmxhc2soKQoKICAgIGRlZiBfY3JlYXRlX3VzZXJfc2Vzc2lvbihzZWxmLCB1c2VybmFtZSwgdG9rZW4pOgogICAgICAgICIiIuWJteW7uueUqOaItuacg+ipsSIiIgogICAgICAgIHNlc3Npb25faWQgPSBzdHIodXVpZDQoKSkKICAgICAgICBzZXNzaW9uX2RhdGEgPSB7CiAgICAgICAgICAgICd1c2VybmFtZSc6IHVzZXJuYW1lLAogICAgICAgICAgICAndG9rZW4nOiB0b2tlbiwKICAgICAgICAgICAgJ2xvZ2luX3RpbWUnOiBkYXRldGltZS5ub3coKSwKICAgICAgICAgICAgJ2NwdF9iYWxhbmNlJzogMCwKICAgICAgICAgICAgJ2NyZWF0ZWRfYXQnOiB0aW1lKCkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgd2l0aCBzZWxmLnNlc3Npb25fbG9jazoKICAgICAgICAgICAgc2VsZi51c2VyX3Nlc3Npb25zW3Nlc3Npb25faWRdID0gc2Vzc2lvbl9kYXRhCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNlc3Npb25faWQKCiAgICBkZWYgX2dldF91c2VyX3Nlc3Npb24oc2VsZiwgc2Vzc2lvbl9pZCk6CiAgICAgICAgIiIi5qC55pOa5pyD6KmxSUTnjbLlj5bnlKjmiLbos4fmlpkiIiIKICAgICAgICB3aXRoIHNlbGYuc2Vzc2lvbl9sb2NrOgogICAgICAgICAgICByZXR1cm4gc2VsZi51c2VyX3Nlc3Npb25zLmdldChzZXNzaW9uX2lkKQoKICAgIGRlZiBfdXBkYXRlX3Nlc3Npb25fYmFsYW5jZShzZWxmLCBzZXNzaW9uX2lkLCBiYWxhbmNlKToKICAgICAgICAiIiLmm7TmlrDmnIPoqbHkuK3nmoTppJjpoY0iIiIKICAgICAgICB3aXRoIHNlbGYuc2Vzc2lvbl9sb2NrOgogICAgICAgICAgICBpZiBzZXNzaW9uX2lkIGluIHNlbGYudXNlcl9zZXNzaW9uczoKICAgICAgICAgICAgICAgIHNlbGYudXNlcl9zZXNzaW9uc1tzZXNzaW9uX2lkXVsnY3B0X2JhbGFuY2UnXSA9IGJhbGFuY2UKCiAgICBkZWYgX2NsZWFyX3VzZXJfc2Vzc2lvbihzZWxmLCBzZXNzaW9uX2lkKToKICAgICAgICAiIiLmuIXpmaTnlKjmiLbmnIPoqbEiIiIKICAgICAgICB3aXRoIHNlbGYuc2Vzc2lvbl9sb2NrOgogICAgICAgICAgICBpZiBzZXNzaW9uX2lkIGluIHNlbGYudXNlcl9zZXNzaW9uczoKICAgICAgICAgICAgICAgIGRlbCBzZWxmLnVzZXJfc2Vzc2lvbnNbc2Vzc2lvbl9pZF0KCiAgICBkZWYgX3NldHVwX3JvdXRlcyhzZWxmKToKICAgICAgICAiIiLoqK3nva4gRmxhc2sg6Lev55SxIiIiCiAgICAgICAgQHNlbGYuYXBwLnJvdXRlKCcvJykKICAgICAgICBkZWYgaW5kZXgoKToKICAgICAgICAgICAgYXZhaWxhYmxlX2xvY2F0aW9ucyA9IFsi5Lqe5rSyIiwgIumdnua0siIsICLljJfnvo4iLCAi5Y2X576OIiwgIuatkOa0siIsICLlpKfmtIvmtLIiLCAiVW5rbm93biJdCiAgICAgICAgICAgIHJldHVybiByZW5kZXJfdGVtcGxhdGUoJ2xvZ2luLmh0bWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZV9pZD1zZWxmLm5vZGVfaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3N0YXR1cz1zZWxmLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9sb2NhdGlvbj1zZWxmLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVfbG9jYXRpb25zPWF2YWlsYWJsZV9sb2NhdGlvbnMpCgogICAgICAgIEBzZWxmLmFwcC5yb3V0ZSgnL21vbml0b3InKQogICAgICAgIGRlZiBtb25pdG9yKCk6CiAgICAgICAgICAgIHNlc3Npb25faWQgPSBzZXNzaW9uLmdldCgnc2Vzc2lvbl9pZCcpCiAgICAgICAgICAgIHVzZXJfZGF0YSA9IHNlbGYuX2dldF91c2VyX3Nlc3Npb24oc2Vzc2lvbl9pZCkgaWYgc2Vzc2lvbl9pZCBlbHNlIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCB1c2VyX2RhdGE6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVkaXJlY3QodXJsX2ZvcignaW5kZXgnKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnMgPSBbIuS6nua0siIsICLpnZ7mtLIiLCAi5YyX576OIiwgIuWNl+e+jiIsICLmrZDmtLIiLCAi5aSn5rSL5rSyIiwgIlVua25vd24iXQogICAgICAgICAgICByZXR1cm4gcmVuZGVyX3RlbXBsYXRlKCdtb25pdG9yLmh0bWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU9dXNlcl9kYXRhWyd1c2VybmFtZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlX2lkPXNlbGYubm9kZV9pZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxfc3RhdHVzPXNlbGYuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2xvY2F0aW9uPXNlbGYubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnM9YXZhaWxhYmxlX2xvY2F0aW9ucykKCiAgICAgICAgQHNlbGYuYXBwLnJvdXRlKCcvbG9naW4nLCBtZXRob2RzPVsnR0VUJywgJ1BPU1QnXSkKICAgICAgICBkZWYgbG9naW5fcm91dGUoKToKICAgICAgICAgICAgaWYgcmVxdWVzdC5tZXRob2QgPT0gJ0dFVCc6CiAgICAgICAgICAgICAgICBzZXNzaW9uX2lkID0gc2Vzc2lvbi5nZXQoJ3Nlc3Npb25faWQnKQogICAgICAgICAgICAgICAgdXNlcl9kYXRhID0gc2VsZi5fZ2V0X3VzZXJfc2Vzc2lvbihzZXNzaW9uX2lkKSBpZiBzZXNzaW9uX2lkIGVsc2UgTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB1c2VyX2RhdGEgYW5kIHVzZXJfZGF0YVsndXNlcm5hbWUnXSA9PSBzZWxmLnVzZXJuYW1lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCh1cmxfZm9yKCdtb25pdG9yJykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnMgPSBbIuS6nua0siIsICLpnZ7mtLIiLCAi5YyX576OIiwgIuWNl+e+jiIsICLmrZDmtLIiLCAi5aSn5rSL5rSyIiwgIlVua25vd24iXQogICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcl90ZW1wbGF0ZSgnbG9naW4uaHRtbCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZV9pZD1zZWxmLm5vZGVfaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9zdGF0dXM9c2VsZi5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2xvY2F0aW9uPXNlbGYubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVfbG9jYXRpb25zPWF2YWlsYWJsZV9sb2NhdGlvbnMpCgogICAgICAgICAgICAjIFBPU1Qg55m75YWlCiAgICAgICAgICAgIHVzZXJuYW1lID0gcmVxdWVzdC5mb3JtLmdldCgndXNlcm5hbWUnKQogICAgICAgICAgICBwYXNzd29yZCA9IHJlcXVlc3QuZm9ybS5nZXQoJ3Bhc3N3b3JkJykKICAgICAgICAgICAgc2VsZWN0ZWRfbG9jYXRpb24gPSByZXF1ZXN0LmZvcm0uZ2V0KCdsb2NhdGlvbicpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOabtOaWsOWcsOWNgOioreWumgogICAgICAgICAgICBpZiBzZWxlY3RlZF9sb2NhdGlvbjoKICAgICAgICAgICAgICAgIHN1Y2Nlc3MsIG1lc3NhZ2UgPSBzZWxmLnVwZGF0ZV9sb2NhdGlvbihzZWxlY3RlZF9sb2NhdGlvbikKICAgICAgICAgICAgICAgIGlmIG5vdCBzdWNjZXNzOgogICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnMgPSBbIuS6nua0siIsICLpnZ7mtLIiLCAi5YyX576OIiwgIuWNl+e+jiIsICLmrZDmtLIiLCAi5aSn5rSL5rSyIiwgIlVua25vd24iXQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJfdGVtcGxhdGUoJ2xvZ2luLmh0bWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcj1mIuWcsOWNgOioreWumumMr+iqpDoge21lc3NhZ2V9IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZV9pZD1zZWxmLm5vZGVfaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc3RhdHVzPXNlbGYuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbG9jYXRpb249c2VsZi5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVfbG9jYXRpb25zPWF2YWlsYWJsZV9sb2NhdGlvbnMpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdXNlcm5hbWUgb3Igbm90IHBhc3N3b3JkOgogICAgICAgICAgICAgICAgYXZhaWxhYmxlX2xvY2F0aW9ucyA9IFsi5Lqe5rSyIiwgIumdnua0siIsICLljJfnvo4iLCAi5Y2X576OIiwgIuatkOa0siIsICLlpKfmtIvmtLIiLCAiVW5rbm93biJdCiAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyX3RlbXBsYXRlKCdsb2dpbi5odG1sJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcj0i6KuL6Ly45YWl55So5oi25ZCN5ZKM5a+G56K8IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlX2lkPXNlbGYubm9kZV9pZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3N0YXR1cz1zZWxmLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbG9jYXRpb249c2VsZi5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnM9YXZhaWxhYmxlX2xvY2F0aW9ucykKCiAgICAgICAgICAgIGlmIHNlbGYuX2xvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCkgYW5kIHNlbGYuX3JlZ2lzdGVyKCk6CiAgICAgICAgICAgICAgICBzZXNzaW9uX2lkID0gc2VsZi5fY3JlYXRlX3VzZXJfc2Vzc2lvbih1c2VybmFtZSwgc2VsZi50b2tlbikKICAgICAgICAgICAgICAgIHNlc3Npb25bJ3Nlc3Npb25faWQnXSA9IHNlc3Npb25faWQKICAgICAgICAgICAgICAgIHNlc3Npb24ucGVybWFuZW50ID0gVHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiJVc2VyICd7dXNlcm5hbWV9JyBsb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5LCBsb2NhdGlvbjoge3NlbGYubG9jYXRpb259IikKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCh1cmxfZm9yKCdtb25pdG9yJykpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhdmFpbGFibGVfbG9jYXRpb25zID0gWyLkup7mtLIiLCAi6Z2e5rSyIiwgIuWMl+e+jiIsICLljZfnvo4iLCAi5q2Q5rSyIiwgIuWkp+a0i+a0siIsICJVbmtub3duIl0KICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJfdGVtcGxhdGUoJ2xvZ2luLmh0bWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yPWYi55m75YWl5aSx5pWXOiB7c2VsZi5zdGF0dXN9IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlX2lkPXNlbGYubm9kZV9pZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3N0YXR1cz1zZWxmLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbG9jYXRpb249c2VsZi5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZV9sb2NhdGlvbnM9YXZhaWxhYmxlX2xvY2F0aW9ucykKCiAgICAgICAgQHNlbGYuYXBwLnJvdXRlKCcvYXBpL3VwZGF0ZV9sb2NhdGlvbicsIG1ldGhvZHM9WydQT1NUJ10pCiAgICAgICAgZGVmIGFwaV91cGRhdGVfbG9jYXRpb24oKToKICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IHNlc3Npb24uZ2V0KCdzZXNzaW9uX2lkJykKICAgICAgICAgICAgdXNlcl9kYXRhID0gc2VsZi5fZ2V0X3VzZXJfc2Vzc2lvbihzZXNzaW9uX2lkKSBpZiBzZXNzaW9uX2lkIGVsc2UgTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVzZXJfZGF0YToKICAgICAgICAgICAgICAgIHJldHVybiBqc29uaWZ5KHsnc3VjY2Vzcyc6IEZhbHNlLCAnZXJyb3InOiAnVW5hdXRob3JpemVkJ30pLCA0MDEKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGEgPSByZXF1ZXN0LmdldF9qc29uKCkKICAgICAgICAgICAgICAgIG5ld19sb2NhdGlvbiA9IGRhdGEuZ2V0KCdsb2NhdGlvbicpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBuZXdfbG9jYXRpb246CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb25pZnkoeydzdWNjZXNzJzogRmFsc2UsICdlcnJvcic6ICfoq4vpgbjmk4flnLDljYAnfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3VjY2VzcywgbWVzc2FnZSA9IHNlbGYudXBkYXRlX2xvY2F0aW9uKG5ld19sb2NhdGlvbikKICAgICAgICAgICAgICAgIHJldHVybiBqc29uaWZ5KHsnc3VjY2Vzcyc6IHN1Y2Nlc3MsICdtZXNzYWdlJzogbWVzc2FnZSwgJ2N1cnJlbnRfbG9jYXRpb24nOiBzZWxmLmxvY2F0aW9ufSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbmlmeSh7J3N1Y2Nlc3MnOiBGYWxzZSwgJ2Vycm9yJzogZifmm7TmlrDlpLHmlZc6IHtzdHIoZSl9J30pCgogICAgICAgIEBzZWxmLmFwcC5yb3V0ZSgnL2FwaS9zdGF0dXMnKQogICAgICAgIGRlZiBhcGlfc3RhdHVzKCk6CiAgICAgICAgICAgIHNlc3Npb25faWQgPSBzZXNzaW9uLmdldCgnc2Vzc2lvbl9pZCcpCiAgICAgICAgICAgIHVzZXJfZGF0YSA9IHNlbGYuX2dldF91c2VyX3Nlc3Npb24oc2Vzc2lvbl9pZCkgaWYgc2Vzc2lvbl9pZCBlbHNlIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5L+u5b6p77ya5aaC5p6c5rKS5pyJ5pyJ5pWI5pyD6Kmx5L2G5pyJ55m76YyE55So5oi277yM5YWB6Kix6Kiq5ZWPCiAgICAgICAgICAgIGlmIG5vdCB1c2VyX2RhdGEgYW5kIHNlbGYudXNlcm5hbWU6CiAgICAgICAgICAgICAgICAjIOWJteW7uuiHqOaZguacg+ipseaVuOaTmueUqOaWvCBBUEkg6Z+/5oeJCiAgICAgICAgICAgICAgICB1c2VyX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogc2VsZi51c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAnY3B0X2JhbGFuY2UnOiBzZWxmLmNwdF9iYWxhbmNlLAogICAgICAgICAgICAgICAgICAgICdsb2dpbl90aW1lJzogc2VsZi5sb2dpbl90aW1lIG9yIGRhdGV0aW1lLm5vdygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgdXNlcl9kYXRhOgogICAgICAgICAgICAgICAgcmV0dXJuIGpzb25pZnkoeydlcnJvcic6ICdVbmF1dGhvcml6ZWQnfSksIDQwMQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3B1X3BlcmNlbnRfdmFsID0gY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MC4xKQogICAgICAgICAgICAgICAgbWVtID0gdmlydHVhbF9tZW1vcnkoKQogICAgICAgICAgICAgICAgY3VycmVudF9hdmFpbGFibGVfZ2IgPSByb3VuZChtZW0uYXZhaWxhYmxlIC8gKDEwMjQqKjMpLCAyKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjcHVfcGVyY2VudF92YWwsIG1lbSA9IDAsIE5vbmUKICAgICAgICAgICAgICAgIGN1cnJlbnRfYXZhaWxhYmxlX2diID0gc2VsZi5tZW1vcnlfZ2IKCiAgICAgICAgICAgIHJldHVybiBqc29uaWZ5KHsKICAgICAgICAgICAgICAgICdub2RlX2lkJzogc2VsZi5ub2RlX2lkLAogICAgICAgICAgICAgICAgJ3N0YXR1cyc6IHNlbGYuc3RhdHVzLAogICAgICAgICAgICAgICAgJ2N1cnJlbnRfdGFza19pZCc6IHNlbGYuY3VycmVudF90YXNrX2lkIG9yICJOb25lIiwKICAgICAgICAgICAgICAgICdpc19yZWdpc3RlcmVkJzogc2VsZi5pc19yZWdpc3RlcmVkLAogICAgICAgICAgICAgICAgJ2RvY2tlcl9hdmFpbGFibGUnOiBzZWxmLmRvY2tlcl9hdmFpbGFibGUsCiAgICAgICAgICAgICAgICAnY3B1X3BlcmNlbnQnOiByb3VuZChjcHVfcGVyY2VudF92YWwsIDEpLAogICAgICAgICAgICAgICAgJ2NwdV9jb3Jlcyc6IHNlbGYuY3B1X2NvcmVzLAogICAgICAgICAgICAgICAgJ21lbW9yeV9wZXJjZW50Jzogcm91bmQobWVtLnBlcmNlbnQsIDEpIGlmIG1lbSBlbHNlIDAsCiAgICAgICAgICAgICAgICAnbWVtb3J5X3VzZWRfZ2InOiByb3VuZChtZW0udXNlZC8oMTAyNCoqMyksIDIpIGlmIG1lbSBlbHNlIDAsCiAgICAgICAgICAgICAgICAnbWVtb3J5X2F2YWlsYWJsZV9nYic6IGN1cnJlbnRfYXZhaWxhYmxlX2diLAogICAgICAgICAgICAgICAgJ21lbW9yeV90b3RhbF9nYic6IGdldGF0dHIoc2VsZiwgJ3RvdGFsX21lbW9yeV9nYicsIHNlbGYubWVtb3J5X2diKSwKICAgICAgICAgICAgICAgICdjcHVfc2NvcmUnOiBzZWxmLmNwdV9zY29yZSwKICAgICAgICAgICAgICAgICdncHVfc2NvcmUnOiBzZWxmLmdwdV9zY29yZSwKICAgICAgICAgICAgICAgICdncHVfbmFtZSc6IHNlbGYuZ3B1X25hbWUsCiAgICAgICAgICAgICAgICAnZ3B1X21lbW9yeV9nYic6IHNlbGYuZ3B1X21lbW9yeV9nYiwKICAgICAgICAgICAgICAgICdjcHRfYmFsYW5jZSc6IHVzZXJfZGF0YVsnY3B0X2JhbGFuY2UnXSwKICAgICAgICAgICAgICAgICdsb2dpbl90aW1lJzogdXNlcl9kYXRhWydsb2dpbl90aW1lJ10uaXNvZm9ybWF0KCkgaWYgaXNpbnN0YW5jZSh1c2VyX2RhdGFbJ2xvZ2luX3RpbWUnXSwgZGF0ZXRpbWUpIGVsc2Ugc3RyKHVzZXJfZGF0YVsnbG9naW5fdGltZSddKSwKICAgICAgICAgICAgICAgICdpcCc6IGdldGF0dHIoc2VsZiwgJ2xvY2FsX2lwJywgJzEyNy4wLjAuMScpCiAgICAgICAgICAgIH0pCgogICAgICAgIEBzZWxmLmFwcC5yb3V0ZSgnL2FwaS9sb2dzJykKICAgICAgICBkZWYgYXBpX2xvZ3MoKToKICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IHNlc3Npb24uZ2V0KCdzZXNzaW9uX2lkJykKICAgICAgICAgICAgdXNlcl9kYXRhID0gc2VsZi5fZ2V0X3VzZXJfc2Vzc2lvbihzZXNzaW9uX2lkKSBpZiBzZXNzaW9uX2lkIGVsc2UgTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDkv67lvqnvvJrlpoLmnpzmspLmnInmnInmlYjmnIPoqbHkvYbmnInnmbvpjITnlKjmiLbvvIzlhYHoqLHoqKrllY8KICAgICAgICAgICAgaWYgbm90IHVzZXJfZGF0YSBhbmQgc2VsZi51c2VybmFtZToKICAgICAgICAgICAgICAgIHVzZXJfZGF0YSA9IHsndXNlcm5hbWUnOiBzZWxmLnVzZXJuYW1lfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHVzZXJfZGF0YToKICAgICAgICAgICAgICAgIHJldHVybiBqc29uaWZ5KHsnZXJyb3InOiAnVW5hdXRob3JpemVkJ30pLCA0MDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIHNlbGYubG9nX2xvY2s6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbmlmeSh7J2xvZ3MnOiBsaXN0KHNlbGYubG9ncyl9KQoKICAgICAgICBAc2VsZi5hcHAucm91dGUoJy9sb2dvdXQnKQogICAgICAgIGRlZiBsb2dvdXQoKToKICAgICAgICAgICAgc2Vzc2lvbl9pZCA9IHNlc3Npb24uZ2V0KCdzZXNzaW9uX2lkJykKICAgICAgICAgICAgaWYgc2Vzc2lvbl9pZDoKICAgICAgICAgICAgICAgIHNlbGYuX2NsZWFyX3VzZXJfc2Vzc2lvbihzZXNzaW9uX2lkKQogICAgICAgICAgICAKICAgICAgICAgICAgc2Vzc2lvbi5jbGVhcigpCiAgICAgICAgICAgIHNlbGYuX2xvZ291dCgpCiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCh1cmxfZm9yKCdpbmRleCcpKQoKICAgIGRlZiBfc3RhcnRfZmxhc2soc2VsZik6CiAgICAgICAgIiIi5ZWf5YuVIEZsYXNrIOacjeWLmSIiIgogICAgICAgIGRlZiBydW5fZmxhc2soKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5hcHAucnVuKGhvc3Q9JzAuMC4wLjAnLCBwb3J0PXNlbGYuZmxhc2tfcG9ydCwgZGVidWc9RmFsc2UsIAogICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VfcmVsb2FkZXI9RmFsc2UsIHRocmVhZGVkPVRydWUpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZsYXNrIGZhaWxlZCB0byBzdGFydDoge2V9IiwgRVJST1IpCiAgICAgICAgICAgICAgICBfZXhpdCgxKQogICAgICAgIAogICAgICAgICMg5ZWf5YuVIEZsYXNrIOacjeWLmQogICAgICAgIFRocmVhZCh0YXJnZXQ9cnVuX2ZsYXNrLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQogICAgICAgIHNlbGYuX2xvZyhmIkZsYXNrIHN0YXJ0ZWQgb24gcG9ydCB7c2VsZi5mbGFza19wb3J0fSIpCiAgICAgICAgCiAgICAgICAgIyDlu7bpgbLplovllZ/ngI/opr3lmagKICAgICAgICBkZWYgb3Blbl9icm93c2VyKCk6CiAgICAgICAgICAgIHNsZWVwKDIpICAjIOetieW+hSBGbGFzayDlrozlhajllZ/li5UKICAgICAgICAgICAgdXJsID0gZiJodHRwOi8vMTI3LjAuMC4xOntzZWxmLmZsYXNrX3BvcnR9IgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB3ZWJfb3Blbih1cmwpCiAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiLngI/opr3lmajlt7LplovllZ86IHt1cmx9IikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi54Sh5rOV6ZaL5ZWf54CP6Ka95ZmoOiB7ZX0iLCBXQVJOSU5HKQogICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYi6KuL5omL5YuV6ZaL5ZWfOiB7dXJsfSIpCiAgICAgICAgCiAgICAgICAgIyDlnKjnjajnq4vnt5rnqIvkuK3plovllZ/ngI/opr3lmagKICAgICAgICBUaHJlYWQodGFyZ2V0PW9wZW5fYnJvd3NlciwgZGFlbW9uPVRydWUpLnN0YXJ0KCkKCiAgICBkZWYgX2xvZ2luKHNlbGYsIHVzZXJuYW1lLCBwYXNzd29yZCk6CiAgICAgICAgIiIi55m75YWl5Yiw56+A6bue5rGgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYudXNlcl9zdHViLkxvZ2luKAogICAgICAgICAgICAgICAgbm9kZXBvb2xfcGIyLkxvZ2luUmVxdWVzdCh1c2VybmFtZT11c2VybmFtZSwgcGFzc3dvcmQ9cGFzc3dvcmQpLCAKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiByZXNwb25zZS5zdWNjZXNzIGFuZCByZXNwb25zZS50b2tlbjoKICAgICAgICAgICAgICAgIHNlbGYudXNlcm5hbWUgPSB1c2VybmFtZQogICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLnRva2VuCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2luX3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgICAgICAgICAgICAgc2VsZi5zdGF0dXMgPSAiTG9nZ2VkIEluIgogICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYiVXNlciB7dXNlcm5hbWV9IGxvZ2dlZCBpbiBzdWNjZXNzZnVsbHkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gIkxvZ2luIEZhaWxlZCIKICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkxvZ2luIGZhaWxlZCBmb3IgdXNlciB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5fbG9nKGYiTG9naW4gZXJyb3I6IHtlfSIsIEVSUk9SKQogICAgICAgICAgICBzZWxmLnN0YXR1cyA9ICJMb2dpbiBGYWlsZWQiCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfcmVnaXN0ZXIoc2VsZik6CiAgICAgICAgIiIi6Ki75YaK56+A6bueIiIiCiAgICAgICAgaWYgbm90IHNlbGYudG9rZW46CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlcXVlc3QgPSBub2RlcG9vbF9wYjIuUmVnaXN0ZXJXb3JrZXJOb2RlUmVxdWVzdCgKICAgICAgICAgICAgICAgIG5vZGVfaWQ9c2VsZi51c2VybmFtZSwKICAgICAgICAgICAgICAgIGhvc3RuYW1lPXNlbGYubG9jYWxfaXAsICAjIOS9v+eUqOacrOapnyBJUCDogIzkuI3mmK8gMTI3LjAuMC4xCiAgICAgICAgICAgICAgICBjcHVfY29yZXM9aW50KHNlbGYuY3B1X2NvcmVzLzEwMDApLAogICAgICAgICAgICAgICAgbWVtb3J5X2diPWludChzZWxmLm1lbW9yeV9nYi8xMCksCiAgICAgICAgICAgICAgICBjcHVfc2NvcmU9c2VsZi5jcHVfc2NvcmUsCiAgICAgICAgICAgICAgICBncHVfc2NvcmU9c2VsZi5ncHVfc2NvcmUsCiAgICAgICAgICAgICAgICBncHVfbmFtZT1zZWxmLmdwdV9uYW1lLAogICAgICAgICAgICAgICAgZ3B1X21lbW9yeV9nYj1pbnQoc2VsZi5ncHVfbWVtb3J5X2diKSwKICAgICAgICAgICAgICAgIGxvY2F0aW9uPXNlbGYubG9jYXRpb24sCiAgICAgICAgICAgICAgICBwb3J0PXNlbGYucG9ydAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYubm9kZV9zdHViLlJlZ2lzdGVyV29ya2VyTm9kZSgKICAgICAgICAgICAgICAgIHJlcXVlc3QsIAogICAgICAgICAgICAgICAgbWV0YWRhdGE9WygnYXV0aG9yaXphdGlvbicsIGYnQmVhcmVyIHtzZWxmLnRva2VufScpXSwgCiAgICAgICAgICAgICAgICB0aW1lb3V0PTE1CiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBzZWxmLm5vZGVfaWQgPSBzZWxmLnVzZXJuYW1lCiAgICAgICAgICAgICAgICBzZWxmLmlzX3JlZ2lzdGVyZWQgPSBUcnVlCiAgICAgICAgICAgICAgICBzZWxmLnN0YXR1cyA9ICJJZGxlIgogICAgICAgICAgICAgICAgc2VsZi5fc3RhcnRfc3RhdHVzX3JlcG9ydGluZygpCiAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiLnr4Dpu57oqLvlhormiJDlip/vvIzkvb/nlKggSVA6IHtzZWxmLmxvY2FsX2lwfTp7c2VsZi5wb3J0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5zdGF0dXMgPSBmIlJlZ2lzdHJhdGlvbiBGYWlsZWQ6IHtyZXNwb25zZS5tZXNzYWdlfSIKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLl9sb2coZiJSZWdpc3RyYXRpb24gZXJyb3I6IHtlfSIsIEVSUk9SKQogICAgICAgICAgICBzZWxmLnN0YXR1cyA9ICJSZWdpc3RyYXRpb24gRmFpbGVkIgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2xvZ291dChzZWxmKToKICAgICAgICAiIiLnmbvlh7rkuKbmuIXnkIbni4DmhYsiIiIKICAgICAgICBvbGRfdXNlcm5hbWUgPSBzZWxmLnVzZXJuYW1lCiAgICAgICAgc2VsZi50b2tlbiA9IE5vbmUKICAgICAgICBzZWxmLnVzZXJuYW1lID0gTm9uZQogICAgICAgIHNlbGYuaXNfcmVnaXN0ZXJlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5zdGF0dXMgPSAiV2FpdGluZyBmb3IgTG9naW4iCiAgICAgICAgc2VsZi5jdXJyZW50X3Rhc2tfaWQgPSBOb25lCiAgICAgICAgc2VsZi5sb2dpbl90aW1lID0gTm9uZQogICAgICAgIHNlbGYuY3B0X2JhbGFuY2UgPSAwCiAgICAgICAgc2VsZi5fc3RvcF9zdGF0dXNfcmVwb3J0aW5nKCkKICAgICAgICAKICAgICAgICBpZiBvbGRfdXNlcm5hbWU6CiAgICAgICAgICAgIHNlbGYuX2xvZyhmIlVzZXIge29sZF91c2VybmFtZX0gbG9nZ2VkIG91dCIpCgogICAgZGVmIF9zdGFydF9zdGF0dXNfcmVwb3J0aW5nKHNlbGYpOgogICAgICAgICIiIumWi+Wni+eLgOaFi+WgseWRiiIiIgogICAgICAgIGlmIHNlbGYuc3RhdHVzX3RocmVhZCBhbmQgc2VsZi5zdGF0dXNfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHNlbGYuX3N0b3BfZXZlbnQuY2xlYXIoKQogICAgICAgIHNlbGYuc3RhdHVzX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9c2VsZi5fc3RhdHVzX3JlcG9ydGVyLCBkYWVtb249VHJ1ZSkKICAgICAgICBzZWxmLnN0YXR1c190aHJlYWQuc3RhcnQoKQoKICAgIGRlZiBfc3RvcF9zdGF0dXNfcmVwb3J0aW5nKHNlbGYpOgogICAgICAgICIiIuWBnOatoueLgOaFi+WgseWRiiIiIgogICAgICAgIHNlbGYuX3N0b3BfZXZlbnQuc2V0KCkKICAgICAgICBpZiBzZWxmLnN0YXR1c190aHJlYWQgYW5kIHNlbGYuc3RhdHVzX3RocmVhZC5pc19hbGl2ZSgpOgogICAgICAgICAgICBzZWxmLnN0YXR1c190aHJlYWQuam9pbih0aW1lb3V0PTUpCgogICAgZGVmIF9zdGF0dXNfcmVwb3J0ZXIoc2VsZik6CiAgICAgICAgIiIi54uA5oWL5aCx5ZGK57ea56iLIiIiCiAgICAgICAgd2hpbGUgbm90IHNlbGYuX3N0b3BfZXZlbnQuaXNfc2V0KCk6CiAgICAgICAgICAgIGlmIHNlbGYuaXNfcmVnaXN0ZXJlZCBhbmQgc2VsZi50b2tlbjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzdGF0dXNfbXNnID0gZiJFeGVjdXRpbmcgVGFzazoge3NlbGYuY3VycmVudF90YXNrX2lkfSIgaWYgc2VsZi5jdXJyZW50X3Rhc2tfaWQgZWxzZSBzZWxmLnN0YXR1cwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg54Sh6KuW5piv5ZCm5Zyo5Z+36KGM5Lu75YuZ6YO96KaB55m86YCB5b+D6LezCiAgICAgICAgICAgICAgICAgICAgc2VsZi5ub2RlX3N0dWIuUmVwb3J0U3RhdHVzKAogICAgICAgICAgICAgICAgICAgICAgICBub2RlcG9vbF9wYjIuUmVwb3J0U3RhdHVzUmVxdWVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVfaWQ9c2VsZi5ub2RlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX21lc3NhZ2U9c3RhdHVzX21zZwogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YT1bKCdhdXRob3JpemF0aW9uJywgZidCZWFyZXIge3NlbGYudG9rZW59JyldLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg5pu05paw6aSY6aGNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBkYXRlX2JhbGFuY2UoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg6Kq/6Kmm5pel6KqMCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXJyZW50X3Rhc2tfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkhlYXJ0YmVhdCBzZW50IHdoaWxlIGV4ZWN1dGluZyB0YXNrIHtzZWxmLmN1cnJlbnRfdGFza19pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIlN0YXR1cyByZXBvcnQgZmFpbGVkOiB7ZX0iLCBXQVJOSU5HKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnuK7nn63lv4Pot7PplpPpmpTku6Xnorrkv53pgKPmjqXnqanlrpoKICAgICAgICAgICAgc2VsZi5fc3RvcF9ldmVudC53YWl0KDEpIAoKICAgIGRlZiBfdXBkYXRlX2JhbGFuY2Uoc2VsZik6CiAgICAgICAgIiIi5pu05pawIENQVCDppJjpoY0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnVzZXJuYW1lIG9yIG5vdCBzZWxmLnRva2VuOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnVzZXJfc3R1Yi5HZXRCYWxhbmNlKAogICAgICAgICAgICAgICAgbm9kZXBvb2xfcGIyLkdldEJhbGFuY2VSZXF1ZXN0KHVzZXJuYW1lPXNlbGYudXNlcm5hbWUsIHRva2VuPXNlbGYudG9rZW4pLAogICAgICAgICAgICAgICAgbWV0YWRhdGE9WygnYXV0aG9yaXphdGlvbicsIGYnQmVhcmVyIHtzZWxmLnRva2VufScpXSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiByZXNwb25zZS5zdWNjZXNzOgogICAgICAgICAgICAgICAgIyDmm7TmlrDmiYDmnInoqbLnlKjmiLbnmoTmnIPoqbHppJjpoY0KICAgICAgICAgICAgICAgIHdpdGggc2VsZi5zZXNzaW9uX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgZm9yIHNlc3Npb25faWQsIHNlc3Npb25fZGF0YSBpbiBzZWxmLnVzZXJfc2Vzc2lvbnMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2Vzc2lvbl9kYXRhWyd1c2VybmFtZSddID09IHNlbGYudXNlcm5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2RhdGFbJ2NwdF9iYWxhbmNlJ10gPSByZXNwb25zZS5iYWxhbmNlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgZGVmIF9zZW5kX3Rhc2tfbG9ncyhzZWxmLCB0YXNrX2lkLCBsb2dzX2NvbnRlbnQpOgogICAgICAgICIiIueZvOmAgeS7u+WLmeaXpeiqjOWIsOevgOm7nuaxoCIiIgogICAgICAgIGlmIG5vdCBzZWxmLm1hc3Rlcl9zdHViIG9yIG5vdCBzZWxmLnRva2VuIG9yIG5vdCB0YXNrX2lkOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdXJyZW50X3RpbWVzdGFtcCA9IGludCh0aW1lKCkpICAjIOS9v+eUqOenkue0muaZgumWk+aIs+iAjOS4jeaYr+avq+enkgogICAgICAgICAgICAKICAgICAgICAgICAgcmVxdWVzdCA9IG5vZGVwb29sX3BiMi5TdG9yZUxvZ3NSZXF1ZXN0KAogICAgICAgICAgICAgICAgbm9kZV9pZD1zZWxmLm5vZGVfaWQsCiAgICAgICAgICAgICAgICB0YXNrX2lkPXRhc2tfaWQsCiAgICAgICAgICAgICAgICBsb2dzPWxvZ3NfY29udGVudCwKICAgICAgICAgICAgICAgIHRpbWVzdGFtcD1jdXJyZW50X3RpbWVzdGFtcAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHNlbGYubWFzdGVyX3N0dWIuU3RvcmVMb2dzKAogICAgICAgICAgICAgICAgcmVxdWVzdCwKICAgICAgICAgICAgICAgIG1ldGFkYXRhPVsoJ2F1dGhvcml6YXRpb24nLCBmJ0JlYXJlciB7c2VsZi50b2tlbn0nKV0sCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiJTdWNjZXNzZnVsbHkgc2VudCBsb2dzIGZvciB0YXNrIHt0YXNrX2lkfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYiRmFpbGVkIHRvIHNlbmQgbG9ncyBmb3IgdGFzayB7dGFza19pZH06IHtyZXNwb25zZS5tZXNzYWdlfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5fbG9nKGYiRXJyb3Igc2VuZGluZyBsb2dzIGZvciB0YXNrIHt0YXNrX2lkfToge2V9IiwgV0FSTklORykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9leGVjdXRlX3Rhc2soc2VsZiwgdGFza19pZCwgdGFza196aXBfYnl0ZXMpOgogICAgICAgICIiIuWft+ihjOS7u+WLmSIiIgogICAgICAgIHNlbGYuY3VycmVudF90YXNrX2lkID0gdGFza19pZAogICAgICAgIHNlbGYuc3RhdHVzID0gZiJFeGVjdXRpbmc6IHt0YXNrX2lkfSIKICAgICAgICBzZWxmLl9zdG9wX2N1cnJlbnRfdGFzayA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgdGVtcF9kaXIgPSBOb25lCiAgICAgICAgY29udGFpbmVyID0gTm9uZQogICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgIHRhc2tfbG9ncyA9IFtdCiAgICAgICAgc3RvcF9yZXF1ZXN0ZWQgPSBGYWxzZQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZG9ja2VyX2F2YWlsYWJsZToKICAgICAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcigiRG9ja2VyIG5vdCBhdmFpbGFibGUiKQoKICAgICAgICAgICAgIyDlibXlu7roh6jmmYLnm67pjIQKICAgICAgICAgICAgdGVtcF9kaXIgPSBta2R0ZW1wKHByZWZpeD1mInRhc2tfe3Rhc2tfaWR9XyIpCiAgICAgICAgICAgIHdvcmtzcGFjZSA9IGpvaW4odGVtcF9kaXIsICJ3b3Jrc3BhY2UiKQogICAgICAgICAgICBtYWtlZGlycyh3b3Jrc3BhY2UpCgogICAgICAgICAgICAjIOino+Wjk+S7u+WLmeaWh+S7tgogICAgICAgICAgICB3aXRoIFppcEZpbGUoQnl0ZXNJTyh0YXNrX3ppcF9ieXRlcyksICdyJykgYXMgemlwX3JlZjoKICAgICAgICAgICAgICAgIHppcF9yZWYuZXh0cmFjdGFsbCh3b3Jrc3BhY2UpCgogICAgICAgICAgICBzZWxmLl9sb2coZiJUYXNrIHt0YXNrX2lkfSBmaWxlcyBleHRyYWN0ZWQgdG8ge3dvcmtzcGFjZX0iKQoKICAgICAgICAgICAgIyDnorrkv50gcnVuX3Rhc2suc2gg5a2Y5Zyo5pa8IHdvcmtzcGFjZQogICAgICAgICAgICBzY3JpcHRfc3JjID0gam9pbihkaXJuYW1lKF9fZmlsZV9fKSwgInJ1bl90YXNrLnNoIikKICAgICAgICAgICAgc2NyaXB0X2RzdCA9IGpvaW4od29ya3NwYWNlLCAicnVuX3Rhc2suc2giKQogICAgICAgICAgICBjb3B5MihzY3JpcHRfc3JjLCBzY3JpcHRfZHN0KQogICAgICAgICAgICBjaG1vZChzY3JpcHRfZHN0LCAwbzc1NSkKCiAgICAgICAgICAgICMg5Z+36KGM5a655Zmo77yM5L2/55So5paw55qE6Y+h5YOP5ZCN56ixCiAgICAgICAgICAgIGNvbnRhaW5lcl9uYW1lID0gZiJ0YXNrLXt0YXNrX2lkfS17dG9rZW5faGV4KDQpfSIKICAgICAgICAgICAgY29udGFpbmVyID0gc2VsZi5kb2NrZXJfY2xpZW50LmNvbnRhaW5lcnMucnVuKAogICAgICAgICAgICAgICAgImp1c3RpbjMwOC9oaXZlbWluZC13b3JrZXI6bGF0ZXN0IiwKICAgICAgICAgICAgICAgIGNvbW1hbmQ9WyJiYXNoIiwgIi9hcHAvdGFzay9ydW5fdGFzay5zaCJdLAogICAgICAgICAgICAgICAgZGV0YWNoPVRydWUsCiAgICAgICAgICAgICAgICBuYW1lPWNvbnRhaW5lcl9uYW1lLAogICAgICAgICAgICAgICAgdm9sdW1lcz17d29ya3NwYWNlOiB7J2JpbmQnOiAnL2FwcC90YXNrJywgJ21vZGUnOiAncncnfX0sCiAgICAgICAgICAgICAgICB3b3JraW5nX2Rpcj0iL2FwcC90YXNrIiwKICAgICAgICAgICAgICAgIGVudmlyb25tZW50PXsiVEFTS19JRCI6IHRhc2tfaWQsICJQWVRIT05VTkJVRkZFUkVEIjogIjEifSwKICAgICAgICAgICAgICAgIHJlbW92ZT1GYWxzZQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLl9sb2coZiJUYXNrIHt0YXNrX2lkfSBjb250YWluZXIgc3RhcnRlZCwgbW9uaXRvcmluZy4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOeZvOmAgeWIneWni+aXpeiqjAogICAgICAgICAgICBpbml0aWFsX2xvZyA9IGYi5Lu75YuZIHt0YXNrX2lkfSDplovlp4vln7fooYxcbuWuueWZqOWQjeeosToge2NvbnRhaW5lcl9uYW1lfVxu5bel5L2c55uu6YyEOiB7d29ya3NwYWNlfSIKICAgICAgICAgICAgdGFza19sb2dzLmFwcGVuZChpbml0aWFsX2xvZykKICAgICAgICAgICAgc2VsZi5fc2VuZF90YXNrX2xvZ3ModGFza19pZCwgaW5pdGlhbF9sb2cpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOewoeWMlueahOebo+aOp+mCj+i8ryAtIOWumuacn+aqouafpeWBnOatouiri+axguWSjOWuueWZqOeLgOaFiwogICAgICAgICAgICBsb2dfYnVmZmVyID0gW10KICAgICAgICAgICAgbG9nX3NlbmRfY291bnRlciA9IDAKICAgICAgICAgICAgbGFzdF9sb2dfZmV0Y2ggPSB0aW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAjIOWEquWFiOaqouafpeWBnOatouiri+axggogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RvcF9jdXJyZW50X3Rhc2s6CiAgICAgICAgICAgICAgICAgICAgc3RvcF9yZXF1ZXN0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgc3RvcF9sb2cgPSBmIuaUtuWIsOWBnOatouiri+axgu+8jOeri+WNs+e1guatouS7u+WLmSB7dGFza19pZH0iCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKHN0b3BfbG9nKQogICAgICAgICAgICAgICAgICAgIHRhc2tfbG9ncy5hcHBlbmQoc3RvcF9sb2cpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VuZF90YXNrX2xvZ3ModGFza19pZCwgc3RvcF9sb2cpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDnq4vljbPlvLfliLblgZzmraLlrrnlmagKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5raWxsKCkKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcF9sb2cgPSBmIuWuueWZqOW3suW8t+WItuWBnOatojoge2NvbnRhaW5lcl9uYW1lfSIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKHN0b3BfbG9nKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2xvZ3MuYXBwZW5kKHN0b3BfbG9nKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZW5kX3Rhc2tfbG9ncyh0YXNrX2lkLCBzdG9wX2xvZykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2xvZyA9IGYi5by35Yi25YGc5q2i5a655Zmo5aSx5pWXOiB7c3RyKGUpfSIKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGVycm9yX2xvZywgV0FSTklORykKICAgICAgICAgICAgICAgICAgICAgICAgdGFza19sb2dzLmFwcGVuZChlcnJvcl9sb2cpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGVycm9yX2xvZykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOaqouafpeWuueWZqOeLgOaFiwogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRhaW5lci5zdGF0dXMgIT0gJ3J1bm5pbmcnOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiJDb250YWluZXIge2NvbnRhaW5lcl9uYW1lfSBzdG9wcGVkIG5hdHVyYWxseSwgc3RhdHVzOiB7Y29udGFpbmVyLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZhaWxlZCB0byBjaGVjayBjb250YWluZXIgc3RhdHVzOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5q+P6ZqUMeenkuWYl+ippuaUtumbhuS4gOasoeaXpeiqjO+8iOmdnumYu+Whnu+8iQogICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gdGltZSgpCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBsYXN0X2xvZ19mZXRjaCA+IDEuMDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMg542y5Y+W5pyA5paw55qE5pel6KqM77yI6Z2e6Zi75aGe77yM5Y+q542y5Y+W5paw55qE5pel6KqM77yJCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ3MgPSBjb250YWluZXIubG9ncyhzaW5jZT1pbnQobGFzdF9sb2dfZmV0Y2gpKS5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdyZXBsYWNlJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9ncy5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2xpbmVzID0gbG9ncy5zdHJpcCgpLnNwbGl0KCdcbicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBsb2dfbGluZXM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZS5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2coZiJbVGFzayB7dGFza19pZH1dOiB7bGluZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfYnVmZmVyLmFwcGVuZChsaW5lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2xvZ3MuYXBwZW5kKGxpbmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ19zZW5kX2NvdW50ZXIgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOavjzIw6KGM5oiW5q+PM+enkueZvOmAgeS4gOasoeaXpeiqjAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9nX3NlbmRfY291bnRlciA+PSAyMCBvciBsZW4obG9nX2J1ZmZlcikgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ3NfdG9fc2VuZCA9ICJcbiIuam9pbihsb2dfYnVmZmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGxvZ3NfdG9fc2VuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfYnVmZmVyLmNsZWFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfc2VuZF9jb3VudGVyID0gMAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9sb2dfZmV0Y2ggPSBjdXJyZW50X3RpbWUKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkVycm9yIGNvbGxlY3RpbmcgbG9nczoge2V9IiwgV0FSTklORykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDnn63mmqvkvJHnnKDvvIznorrkv53og73lv6vpgJ/pn7/mh4nlgZzmraLoq4vmsYIKICAgICAgICAgICAgICAgIHNsZWVwKDAuMSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg55m86YCB5Ymp6aSY55qE5pel6KqMCiAgICAgICAgICAgIGlmIGxvZ19idWZmZXI6CiAgICAgICAgICAgICAgICBsb2dzX3RvX3NlbmQgPSAiXG4iLmpvaW4obG9nX2J1ZmZlcikKICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGxvZ3NfdG9fc2VuZCkKICAgICAgICAgICAgICAgIHRhc2tfbG9ncy5leHRlbmQobG9nX2J1ZmZlcikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg6JmV55CG5Lu75YuZ5a6M5oiQ5oiW5YGc5q2iCiAgICAgICAgICAgIGlmIHN0b3BfcmVxdWVzdGVkOgogICAgICAgICAgICAgICAgc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgICAgICBjb21wbGV0aW9uX2xvZyA9IGYi5Lu75YuZIHt0YXNrX2lkfSDooqvnlKjmiLblvLfliLblgZzmraIiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIOS7u+WLmeiHqueEtue1kOadn++8jOaqouafpemAgOWHuueivAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRhaW5lci53YWl0KHRpbWVvdXQ9MikKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gcmVzdWx0LmdldCgnU3RhdHVzQ29kZScsIC0xKSA9PSAwCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbl9sb2cgPSBmIuS7u+WLmSB7dGFza19pZH0g5Z+36KGM5a6M5oiQ77yM6YCA5Ye656K8OiB7cmVzdWx0LmdldCgnU3RhdHVzQ29kZScsIC0xKX0iCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbl9sb2cgPSBmIuS7u+WLmSB7dGFza19pZH0g5a6M5oiQ54uA5oWL5qqi5p+l5aSx5pWXOiB7c3RyKGUpfSIKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuX2xvZyhjb21wbGV0aW9uX2xvZykKICAgICAgICAgICAgdGFza19sb2dzLmFwcGVuZChjb21wbGV0aW9uX2xvZykKICAgICAgICAgICAgc2VsZi5fc2VuZF90YXNrX2xvZ3ModGFza19pZCwgY29tcGxldGlvbl9sb2cpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOeri+WNs+aJk+WMhee1kOaenO+8jOWMheWQq+S7u+WLmeaXpeiqjAogICAgICAgICAgICByZXN1bHRfemlwID0gc2VsZi5fY3JlYXRlX3Jlc3VsdF96aXAodGFza19pZCwgd29ya3NwYWNlLCBzdWNjZXNzLCBzdG9wX3JlcXVlc3RlZCwgdGFza19sb2dzKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnmbzpgIHntZDmnpzliLDnr4Dpu57msaAKICAgICAgICAgICAgaWYgcmVzdWx0X3ppcDoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLm1hc3Rlcl9zdHViLlJldHVyblRhc2tSZXN1bHQoCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVwb29sX3BiMi5SZXR1cm5UYXNrUmVzdWx0UmVxdWVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfaWQ9dGFza19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF96aXA9cmVzdWx0X3ppcAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YT1bKCdhdXRob3JpemF0aW9uJywgZidCZWFyZXIge3NlbGYudG9rZW59JyldLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTMwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdF9sb2cgPSBmIuS7u+WLmSB7dGFza19pZH0g57WQ5p6c5bey55m86YCB5Yiw56+A6bue5rGg77yI54uA5oWLOiB7J+W8t+WItuWBnOatoicgaWYgc3RvcF9yZXF1ZXN0ZWQgZWxzZSAn5a6M5oiQJ33vvIkiCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKHJlc3VsdF9sb2cpCiAgICAgICAgICAgICAgICAgICAgdGFza19sb2dzLmFwcGVuZChyZXN1bHRfbG9nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIHJlc3VsdF9sb2cpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbG9nID0gZiLnmbzpgIHku7vli5nntZDmnpzlpLHmlZc6IHtzdHIoZSl9IgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhlcnJvcl9sb2csIEVSUk9SKQogICAgICAgICAgICAgICAgICAgIHRhc2tfbG9ncy5hcHBlbmQoZXJyb3JfbG9nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGVycm9yX2xvZykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9sb2cgPSBmIuS7u+WLmSB7dGFza19pZH0g5Z+36KGM5aSx5pWXOiB7c3RyKGUpfSIKICAgICAgICAgICAgc2VsZi5fbG9nKGVycm9yX2xvZywgRVJST1IpCiAgICAgICAgICAgIHRhc2tfbG9ncy5hcHBlbmQoZXJyb3JfbG9nKQogICAgICAgICAgICBzZWxmLl9zZW5kX3Rhc2tfbG9ncyh0YXNrX2lkLCBlcnJvcl9sb2cpCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgIAogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMg5riF55CG5a655Zmo77yI5by35Yi25riF55CG77yJCiAgICAgICAgICAgIGlmIGNvbnRhaW5lcjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5raWxsKCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucmVtb3ZlKGZvcmNlPVRydWUpCiAgICAgICAgICAgICAgICAgICAgY2xlYW51cF9sb2cgPSBmIuS7u+WLmSB7dGFza19pZH0g5a655Zmo5bey5by35Yi25riF55CGIgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhjbGVhbnVwX2xvZykKICAgICAgICAgICAgICAgICAgICB0YXNrX2xvZ3MuYXBwZW5kKGNsZWFudXBfbG9nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGNsZWFudXBfbG9nKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGNsZWFudXBfZXJyb3IgPSBmIua4heeQhuWuueWZqOWkseaVlzoge3N0cihlKX0iCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGNsZWFudXBfZXJyb3IsIFdBUk5JTkcpCiAgICAgICAgICAgICAgICAgICAgdGFza19sb2dzLmFwcGVuZChjbGVhbnVwX2Vycm9yKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfdGFza19sb2dzKHRhc2tfaWQsIGNsZWFudXBfZXJyb3IpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOa4heeQhuiHqOaZguebrumMhAogICAgICAgICAgICBpZiB0ZW1wX2RpciBhbmQgZXhpc3RzKHRlbXBfZGlyKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBybXRyZWUodGVtcF9kaXIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nKGYiVGVtcG9yYXJ5IGRpcmVjdG9yeSB7dGVtcF9kaXJ9IGNsZWFuZWQgdXAiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZhaWxlZCB0byBjbGVhbiB1cCB0ZW1wIGRpcjoge2V9IiwgV0FSTklORykKICAgICAgICAgICAgCiAgICAgICAgICAgICMg55m86YCB5pyA57WC55qE5a6M5pW05pel6KqMCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZpbmFsX2xvZ3MgPSAiXG4iLmpvaW4odGFza19sb2dzKQogICAgICAgICAgICAgICAgc2VsZi5fc2VuZF90YXNrX2xvZ3ModGFza19pZCwgZiI9PT0g5Lu75YuZ5a6M5pW05pel6KqMID09PVxue2ZpbmFsX2xvZ3N9XG49PT0g5pel6KqM57WQ5p2fID09PSIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZhaWxlZCB0byBzZW5kIGZpbmFsIGxvZ3M6IHtlfSIsIFdBUk5JTkcpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOmAmuefpeWujOaIkAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLm1hc3Rlcl9zdHViLlRhc2tDb21wbGV0ZWQoCiAgICAgICAgICAgICAgICAgICAgbm9kZXBvb2xfcGIyLlRhc2tDb21wbGV0ZWRSZXF1ZXN0KAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkPXRhc2tfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVfaWQ9c2VsZi5ub2RlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzPXN1Y2Nlc3MgYW5kIG5vdCBzdG9wX3JlcXVlc3RlZAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE9WygnYXV0aG9yaXphdGlvbicsIGYnQmVhcmVyIHtzZWxmLnRva2VufScpXSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYuX2xvZyhmIkZhaWxlZCB0byBub3RpZnkgdGFzayBjb21wbGV0aW9uOiB7ZX0iLCBXQVJOSU5HKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDph43nva7ni4DmhYsKICAgICAgICAgICAgc2VsZi5jdXJyZW50X3Rhc2tfaWQgPSBOb25lCiAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gIklkbGUiCiAgICAgICAgICAgIHNlbGYuX3N0b3BfY3VycmVudF90YXNrID0gRmFsc2UKICAgICAgICAgICAgc3RhdHVzX21zZyA9ICLlvLfliLblgZzmraLkuKblt7LmiZPljIXntZDmnpwiIGlmIHN0b3BfcmVxdWVzdGVkIGVsc2UgIuWft+ihjOWujOaIkCIKICAgICAgICAgICAgc2VsZi5fbG9nKGYiVGFzayB7dGFza19pZH0gY2xlYW51cCBjb21wbGV0ZWQsIHN0YXR1cyByZXNldCB0byBJZGxlICh7c3RhdHVzX21zZ30pIikKCiAgICBkZWYgX2NyZWF0ZV9yZXN1bHRfemlwKHNlbGYsIHRhc2tfaWQsIHdvcmtzcGFjZSwgc3VjY2Vzcywgc3RvcHBlZD1GYWxzZSwgdGFza19sb2dzPU5vbmUpOgogICAgICAgICIiIuWJteW7uue1kOaenCBaSVDvvIzljIXlkKvlgZzmraLni4DmhYvkv6Hmga/lkozku7vli5nml6XoqowiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg5Ym15bu65Z+36KGM5pel6KqM77yM5YyF5ZCr5YGc5q2i5L+h5oGvCiAgICAgICAgICAgIGxvZ19maWxlID0gam9pbih3b3Jrc3BhY2UsICJleGVjdXRpb25fbG9nLnR4dCIpCiAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShmIlRhc2sgSUQ6IHt0YXNrX2lkfVxuIikKICAgICAgICAgICAgICAgIGlmIHN0b3BwZWQ6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIlN0YXR1czogU3RvcHBlZCBieSB1c2VyXG4iKQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJFeGVjdXRpb24gUmVzdWx0OiBUZXJtaW5hdGVkXG4iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiU3RhdHVzOiB7J1N1Y2Nlc3MnIGlmIHN1Y2Nlc3MgZWxzZSAnRmFpbGVkJ31cbiIpCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkV4ZWN1dGlvbiBSZXN1bHQ6IHsnQ29tcGxldGVkJyBpZiBzdWNjZXNzIGVsc2UgJ0Vycm9yJ31cbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiVGltZToge2RhdGV0aW1lLm5vdygpfVxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoZiJOb2RlOiB7c2VsZi5ub2RlX2lkfVxuIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc3RvcHBlZDoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiXG5Ob3RlOiBUaGlzIHRhc2sgd2FzIHN0b3BwZWQgYnkgdXNlciByZXF1ZXN0LlxuIikKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiQW55IHBhcnRpYWwgcmVzdWx0cyBvciBpbnRlcm1lZGlhdGUgZmlsZXMgYXJlIGluY2x1ZGVkIGluIHRoaXMgcGFja2FnZS5cbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWJteW7uuS7u+WLmeWujOaVtOaXpeiqjOaWh+S7tgogICAgICAgICAgICBpZiB0YXNrX2xvZ3M6CiAgICAgICAgICAgICAgICB0YXNrX2xvZ19maWxlID0gam9pbih3b3Jrc3BhY2UsICJ0YXNrX2xvZ3MudHh0IikKICAgICAgICAgICAgICAgIHdpdGggb3Blbih0YXNrX2xvZ19maWxlLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIj09PSBUYXNrIHt0YXNrX2lkfSBDb21wbGV0ZSBMb2dzID09PVxuIikKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR2VuZXJhdGVkIGF0OiB7ZGF0ZXRpbWUubm93KCl9XG4iKQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJTdGF0dXM6IHsnU3RvcHBlZCBieSB1c2VyJyBpZiBzdG9wcGVkIGVsc2UgKCdTdWNjZXNzJyBpZiBzdWNjZXNzIGVsc2UgJ0ZhaWxlZCcpfVxuIikKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiTm9kZToge3NlbGYubm9kZV9pZH1cblxuIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgbG9nX2VudHJ5IGluIHRhc2tfbG9nczoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIntsb2dfZW50cnl9XG4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJcbj09PSBFbmQgb2YgTG9ncyA9PT1cbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWJteW7uuWBnOatoueLgOaFi+aWh+S7tu+8iOWmguaenOS7u+WLmeiiq+WBnOatou+8iQogICAgICAgICAgICBpZiBzdG9wcGVkOgogICAgICAgICAgICAgICAgc3RvcF9maWxlID0gam9pbih3b3Jrc3BhY2UsICJ0YXNrX3N0b3BwZWQudHh0IikKICAgICAgICAgICAgICAgIHdpdGggb3BlbihzdG9wX2ZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiVGFzayB7dGFza19pZH0gd2FzIHN0b3BwZWQgYnkgdXNlciByZXF1ZXN0IGF0IHtkYXRldGltZS5ub3coKX1cbiIpCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIlRoaXMgZmlsZSBpbmRpY2F0ZXMgdGhhdCB0aGUgdGFzayBkaWQgbm90IGNvbXBsZXRlIG5vcm1hbGx5LlxuIikKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiQ2hlY2sgZXhlY3V0aW9uX2xvZy50eHQgYW5kIHRhc2tfbG9ncy50eHQgZm9yIG1vcmUgZGV0YWlscy5cbiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOaJk+WMheaVtOWAi+W3peS9nOebrumMhAogICAgICAgICAgICB6aXBfYnVmZmVyID0gQnl0ZXNJTygpCiAgICAgICAgICAgIHdpdGggWmlwRmlsZSh6aXBfYnVmZmVyLCAndycsIFpJUF9ERUZMQVRFRCkgYXMgemlwX2ZpbGU6CiAgICAgICAgICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gd2Fsayh3b3Jrc3BhY2UpOgogICAgICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBqb2luKHJvb3QsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFyY25hbWUgPSByZWxwYXRoKGZpbGVfcGF0aCwgd29ya3NwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICB6aXBfZmlsZS53cml0ZShmaWxlX3BhdGgsIGFyY25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHRfc2l6ZSA9IGxlbih6aXBfYnVmZmVyLmdldHZhbHVlKCkpCiAgICAgICAgICAgIHNlbGYuX2xvZyhmIkNyZWF0ZWQgcmVzdWx0IHppcCBmb3IgdGFzayB7dGFza19pZH06IHtyZXN1bHRfc2l6ZX0gYnl0ZXMgKHsnc3RvcHBlZCcgaWYgc3RvcHBlZCBlbHNlICdjb21wbGV0ZWQnfSksIGxvZ3MgaW5jbHVkZWQiKQogICAgICAgICAgICByZXR1cm4gemlwX2J1ZmZlci5nZXR2YWx1ZSgpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5fbG9nKGYiRmFpbGVkIHRvIGNyZWF0ZSByZXN1bHQgemlwOiB7ZX0iLCBFUlJPUikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5aaC5p6c5omT5YyF5aSx5pWX77yM5Ym15bu65LiA5YCL5YyF5ZCr6Yyv6Kqk5L+h5oGv55qE57Ch5ZauWklQCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHppcF9idWZmZXIgPSBCeXRlc0lPKCkKICAgICAgICAgICAgICAgIHdpdGggWmlwRmlsZSh6aXBfYnVmZmVyLCAndycsIFpJUF9ERUZMQVRFRCkgYXMgemlwX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfY29udGVudCA9IGYiVGFzayB7dGFza19pZH0gcGFja2FnaW5nIGZhaWxlZDoge3N0cihlKX1cbiIKICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb250ZW50ICs9IGYiU3RhdHVzOiB7J1N0b3BwZWQnIGlmIHN0b3BwZWQgZWxzZSAnRmFpbGVkJ31cbiIKICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb250ZW50ICs9IGYiVGltZToge2RhdGV0aW1lLm5vdygpfVxuIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg5ZiX6Kmm5YyF5ZCr6YOo5YiG5pel6KqMCiAgICAgICAgICAgICAgICAgICAgaWYgdGFza19sb2dzOgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb250ZW50ICs9IGYiXG49PT0gUGFydGlhbCBMb2dzID09PVxuIgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbG9nX2VudHJ5IGluIHRhc2tfbG9nc1stNTA6XTogICMg5pyA5b6MNTDooYzml6XoqowKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2NvbnRlbnQgKz0gZiJ7bG9nX2VudHJ5fVxuIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHppcF9maWxlLndyaXRlc3RyKCJlcnJvcl9sb2cudHh0IiwgZXJyb3JfY29udGVudCkKICAgICAgICAgICAgICAgIHJldHVybiB6aXBfYnVmZmVyLmdldHZhbHVlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2xvZyhzZWxmLCBtZXNzYWdlLCBsZXZlbD1JTkZPKToKICAgICAgICAiIiLoqJjpjITml6XoqowiIiIKICAgICAgICBpZiBsZXZlbCA9PSBJTkZPOgogICAgICAgICAgICBpbmZvKG1lc3NhZ2UpCiAgICAgICAgZWxpZiBsZXZlbCA9PSBXQVJOSU5HOgogICAgICAgICAgICB3YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgZWxpZiBsZXZlbCA9PSBFUlJPUjoKICAgICAgICAgICAgZXJyb3IobWVzc2FnZSkKICAgICAgICAKICAgICAgICB3aXRoIHNlbGYubG9nX2xvY2s6CiAgICAgICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpCiAgICAgICAgICAgIGxldmVsX25hbWUgPSBnZXRMZXZlbE5hbWUobGV2ZWwpCiAgICAgICAgICAgIHNlbGYubG9ncy5hcHBlbmQoZiJ7dGltZXN0YW1wfSAtIHtsZXZlbF9uYW1lfSAtIHttZXNzYWdlfSIpCiAgICAgICAgICAgIGlmIGxlbihzZWxmLmxvZ3MpID4gNTAwOgogICAgICAgICAgICAgICAgc2VsZi5sb2dzLnBvcCgwKQoKIyBnUlBDIOacjeWLmeWvpuePvgpjbGFzcyBXb3JrZXJOb2RlU2VydmljZXIobm9kZXBvb2xfcGIyX2dycGMuV29ya2VyTm9kZVNlcnZpY2VTZXJ2aWNlcik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgd29ya2VyX25vZGUpOgogICAgICAgIHNlbGYud29ya2VyX25vZGUgPSB3b3JrZXJfbm9kZQoKICAgIGRlZiBFeGVjdXRlVGFzayhzZWxmLCByZXF1ZXN0LCBjb250ZXh0KToKICAgICAgICAiIiLln7fooYzku7vli5kgUlBDIiIiCiAgICAgICAgdGFza19pZCA9IHJlcXVlc3QudGFza19pZAogICAgICAgIHRhc2tfemlwID0gcmVxdWVzdC50YXNrX3ppcAogICAgICAgIAogICAgICAgIGZpbGVfc2l6ZV9tYiA9IGxlbih0YXNrX3ppcCkgLyAoMTAyNCAqIDEwMjQpCiAgICAgICAgaW5mbyhmIj09PT09IOaUtuWIsOWft+ihjOS7u+WLmeiri+axgiA9PT09PSIpCiAgICAgICAgaW5mbyhmIuS7u+WLmUlEOiB7dGFza19pZH0iKQogICAgICAgIGluZm8oZiLmqpTmoYjlpKflsI86IHtmaWxlX3NpemVfbWI6LjFmfU1CIikKICAgICAgICBpbmZvKGYi55W25YmN56+A6bue54uA5oWLOiB7c2VsZi53b3JrZXJfbm9kZS5zdGF0dXN9IikKICAgICAgICBpbmZvKGYi5piv5ZCm5bey6Ki75YaKOiB7c2VsZi53b3JrZXJfbm9kZS5pc19yZWdpc3RlcmVkfSIpCiAgICAgICAgaW5mbyhmIkRvY2tlciDlj6/nlKg6IHtzZWxmLndvcmtlcl9ub2RlLmRvY2tlcl9hdmFpbGFibGV9IikKICAgICAgICAKICAgICAgICAjIOW/q+mAn+aqouafpeevgOm7nueLgOaFiwogICAgICAgIGlmIHNlbGYud29ya2VyX25vZGUuY3VycmVudF90YXNrX2lkOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIuevgOm7nuW/meeijOS4re+8jOaLkue1leS7u+WLmSB7dGFza19pZH0gKOeVtuWJjeS7u+WLmToge3NlbGYud29ya2VyX25vZGUuY3VycmVudF90YXNrX2lkfSkiCiAgICAgICAgICAgIHdhcm5pbmcoZXJyb3JfbXNnKQogICAgICAgICAgICByZXR1cm4gbm9kZXBvb2xfcGIyLkV4ZWN1dGVUYXNrUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBzdWNjZXNzPUZhbHNlLCAKICAgICAgICAgICAgICAgIG1lc3NhZ2U9ZXJyb3JfbXNnCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBub3Qgc2VsZi53b3JrZXJfbm9kZS5kb2NrZXJfYXZhaWxhYmxlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIkRvY2tlciDkuI3lj6/nlKjvvIzmi5LntZXku7vli5kge3Rhc2tfaWR9IgogICAgICAgICAgICBlcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuRXhlY3V0ZVRhc2tSZXNwb25zZSgKICAgICAgICAgICAgICAgIHN1Y2Nlc3M9RmFsc2UsIAogICAgICAgICAgICAgICAgbWVzc2FnZT0iRG9ja2VyIG5vdCBhdmFpbGFibGUiCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAjIOaqouafpeS7u+WLmeaVuOaTmuWujOaVtOaAp+WSjOWkp+WwjwogICAgICAgIGlmIG5vdCB0YXNrX3ppcDoKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiLku7vli5kge3Rhc2tfaWR9IOaVuOaTmueCuuepuiIKICAgICAgICAgICAgZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICByZXR1cm4gbm9kZXBvb2xfcGIyLkV4ZWN1dGVUYXNrUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBzdWNjZXNzPUZhbHNlLCAKICAgICAgICAgICAgICAgIG1lc3NhZ2U9IlRhc2sgZGF0YSBpcyBlbXB0eSIKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICMg5qqi5p+l5qqU5qGI5aSn5bCP6ZmQ5Yi277yIMTAwTULvvIkKICAgICAgICBpZiBmaWxlX3NpemVfbWIgPiAxMDA6CiAgICAgICAgICAgIGVycm9yX21zZyA9IGYi5Lu75YuZIHt0YXNrX2lkfSDmqpTmoYjlpKrlpKc6IHtmaWxlX3NpemVfbWI6LjFmfU1C77yM6LaF6YGOMTAwTULpmZDliLYiCiAgICAgICAgICAgIGVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgcmV0dXJuIG5vZGVwb29sX3BiMi5FeGVjdXRlVGFza1Jlc3BvbnNlKAogICAgICAgICAgICAgICAgc3VjY2Vzcz1GYWxzZSwgCiAgICAgICAgICAgICAgICBtZXNzYWdlPWYiVGFzayBmaWxlIHRvbyBsYXJnZToge2ZpbGVfc2l6ZV9tYjouMWZ9TUIgKGxpbWl0OiAxMDBNQikiCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg56uL5Y2z6Z+/5oeJ5o6l5Y+X5Lu75YuZ77yM6YG/5YWN6LaF5pmCCiAgICAgICAgICAgIHNlbGYud29ya2VyX25vZGUuY3VycmVudF90YXNrX2lkID0gdGFza19pZAogICAgICAgICAgICBzZWxmLndvcmtlcl9ub2RlLnN0YXR1cyA9IGYiUmVjZWl2aW5nOiB7dGFza19pZH0gKHtmaWxlX3NpemVfbWI6LjFmfU1CKSIKICAgICAgICAgICAgCiAgICAgICAgICAgIGluZm8oZiLplovlp4vmjqXlj5fku7vli5kge3Rhc2tfaWR977yM54uA5oWL5pu05paw54K6OiB7c2VsZi53b3JrZXJfbm9kZS5zdGF0dXN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg6aCQ5YWI6amX6K2JIFpJUCDmqpTmoYjlrozmlbTmgKcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBaaXBGaWxlKEJ5dGVzSU8odGFza196aXApLCAncicpIGFzIHppcF9yZWY6CiAgICAgICAgICAgICAgICAgICAgemlwX3JlZi50ZXN0emlwKCkKICAgICAgICAgICAgICAgIGluZm8oZiLku7vli5kge3Rhc2tfaWR9IFpJUCDmqpTmoYjpqZforYnmiJDlip8iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIHppcF9lcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYud29ya2VyX25vZGUuY3VycmVudF90YXNrX2lkID0gTm9uZQogICAgICAgICAgICAgICAgc2VsZi53b3JrZXJfbm9kZS5zdGF0dXMgPSAiSWRsZSIKICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYi5Lu75YuZIHt0YXNrX2lkfSBaSVAg5qqU5qGI5pCN5aOeOiB7emlwX2Vycm9yfSIKICAgICAgICAgICAgICAgIGVycm9yKGVycm9yX21zZykKICAgICAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuRXhlY3V0ZVRhc2tSZXNwb25zZSgKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzPUZhbHNlLCAKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlPWYiSW52YWxpZCBaSVAgZmlsZToge3N0cih6aXBfZXJyb3IpfSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5pu05paw54uA5oWL54K65rqW5YKZ5Z+36KGMCiAgICAgICAgICAgIHNlbGYud29ya2VyX25vZGUuc3RhdHVzID0gZiJQcmVwYXJpbmc6IHt0YXNrX2lkfSIKICAgICAgICAgICAgaW5mbyhmIuS7u+WLmSB7dGFza19pZH0g5qqU5qGI6amX6K2J5a6M5oiQ77yM6ZaL5aeL5rqW5YKZ5Z+36KGMIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5ZWf5YuV5Z+36KGM57ea56iLCiAgICAgICAgICAgIGV4ZWN1dGlvbl90aHJlYWQgPSBUaHJlYWQoCiAgICAgICAgICAgICAgICB0YXJnZXQ9c2VsZi53b3JrZXJfbm9kZS5fZXhlY3V0ZV90YXNrLAogICAgICAgICAgICAgICAgYXJncz0odGFza19pZCwgdGFza196aXApLAogICAgICAgICAgICAgICAgZGFlbW9uPVRydWUsCiAgICAgICAgICAgICAgICBuYW1lPWYiVGFza0V4ZWN1dGlvbi17dGFza19pZH0iCiAgICAgICAgICAgICkKICAgICAgICAgICAgZXhlY3V0aW9uX3RocmVhZC5zdGFydCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdWNjZXNzX21zZyA9IGYi5Lu75YuZIHt0YXNrX2lkfSDlt7LmjqXlj5fkuKbplovlp4vmupblgpnln7fooYwgKOaqlOahiOWkp+Wwjzoge2ZpbGVfc2l6ZV9tYjouMWZ9TUIpIgogICAgICAgICAgICBpbmZvKHN1Y2Nlc3NfbXNnKQogICAgICAgICAgICBpbmZvKGYiPT09PT0g5Lu75YuZ5o6l5Y+X5a6M5oiQID09PT09IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuRXhlY3V0ZVRhc2tSZXNwb25zZSgKICAgICAgICAgICAgICAgIHN1Y2Nlc3M9VHJ1ZSwgCiAgICAgICAgICAgICAgICBtZXNzYWdlPWYiVGFzayB7dGFza19pZH0gYWNjZXB0ZWQsIGZpbGUgc2l6ZToge2ZpbGVfc2l6ZV9tYjouMWZ9TUIiCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAjIOWmguaenOWHuumMr++8jOmHjee9rueLgOaFiwogICAgICAgICAgICBzZWxmLndvcmtlcl9ub2RlLmN1cnJlbnRfdGFza19pZCA9IE5vbmUKICAgICAgICAgICAgc2VsZi53b3JrZXJfbm9kZS5zdGF0dXMgPSAiSWRsZSIKICAgICAgICAgICAgZXJyb3JfbXNnID0gZiLmjqXlj5fku7vli5kge3Rhc2tfaWR9IOaZgueZvOeUn+mMr+iqpDoge2V9IgogICAgICAgICAgICBlcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuRXhlY3V0ZVRhc2tSZXNwb25zZSgKICAgICAgICAgICAgICAgIHN1Y2Nlc3M9RmFsc2UsIAogICAgICAgICAgICAgICAgbWVzc2FnZT1mIkZhaWxlZCB0byBhY2NlcHQgdGFzazoge3N0cihlKX0iCiAgICAgICAgICAgICkKCiAgICBkZWYgUmVwb3J0UnVubmluZ1N0YXR1cyhzZWxmLCByZXF1ZXN0LCBjb250ZXh0KToKICAgICAgICAiIiLloLHlkYrpgYvooYzni4DmhYsiIiIKICAgICAgICB0YXNrX2lkID0gcmVxdWVzdC50YXNrX2lkCiAgICAgICAgaWYgc2VsZi53b3JrZXJfbm9kZS5jdXJyZW50X3Rhc2tfaWQgPT0gdGFza19pZDoKICAgICAgICAgICAgcmV0dXJuIG5vZGVwb29sX3BiMi5SdW5uaW5nU3RhdHVzUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBzdWNjZXNzPVRydWUsCiAgICAgICAgICAgICAgICBtZXNzYWdlPWYiVGFzayB7dGFza19pZH0gcnVubmluZyIKICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuUnVubmluZ1N0YXR1c1Jlc3BvbnNlKAogICAgICAgICAgICAgICAgc3VjY2Vzcz1GYWxzZSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U9ZiJOb3QgcnVubmluZyB0YXNrIHt0YXNrX2lkfSIKICAgICAgICAgICAgKQoKICAgIGRlZiBTdG9wVGFza0V4ZWN1dGlvbihzZWxmLCByZXF1ZXN0LCBjb250ZXh0KToKICAgICAgICAiIiLnq4vljbPlvLfliLblgZzmraLku7vli5nln7fooYzkuKbmiZPljIXntZDmnpwiIiIKICAgICAgICB0YXNrX2lkID0gcmVxdWVzdC50YXNrX2lkCiAgICAgICAgaWYgc2VsZi53b3JrZXJfbm9kZS5jdXJyZW50X3Rhc2tfaWQgPT0gdGFza19pZDoKICAgICAgICAgICAgaW5mbyhmIuaUtuWIsOWBnOatouS7u+WLmSB7dGFza19pZH0g55qE6KuL5rGC77yM56uL5Y2z5Z+36KGM5by35Yi25YGc5q2iIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg56uL5Y2z6Kit572u5YGc5q2i5qiZ6KqMCiAgICAgICAgICAgIHNlbGYud29ya2VyX25vZGUuX3N0b3BfY3VycmVudF90YXNrID0gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnrYnlvoXku7vli5nomZXnkIblgZzmraLoq4vmsYLvvIzkvYbmmYLplpPovIPnn60KICAgICAgICAgICAgbWF4X3dhaXRfdGltZSA9IDEwCiAgICAgICAgICAgIHdhaXRfY291bnQgPSAwCiAgICAgICAgICAgIHdoaWxlIHNlbGYud29ya2VyX25vZGUuY3VycmVudF90YXNrX2lkID09IHRhc2tfaWQgYW5kIHdhaXRfY291bnQgPCBtYXhfd2FpdF90aW1lOgogICAgICAgICAgICAgICAgc2xlZXAoMC41KQogICAgICAgICAgICAgICAgd2FpdF9jb3VudCArPSAwLjUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDmr48y56eS5aCx5ZGK5LiA5qyh6YCy5bqmCiAgICAgICAgICAgICAgICBpZiBpbnQod2FpdF9jb3VudCkgJSAyID09IDAgYW5kIHdhaXRfY291bnQgPiAwOgogICAgICAgICAgICAgICAgICAgIGluZm8oZiLlvLfliLblgZzmraLku7vli5kge3Rhc2tfaWR9IOiZleeQhuS4rS4uLiAoe3dhaXRfY291bnQ6LjFmfS97bWF4X3dhaXRfdGltZX3np5IpIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHdhaXRfY291bnQgPj0gbWF4X3dhaXRfdGltZToKICAgICAgICAgICAgICAgICMg5aaC5p6c6LaF5pmC77yM55u05o6l6YeN572u54uA5oWLCiAgICAgICAgICAgICAgICBzZWxmLndvcmtlcl9ub2RlLmN1cnJlbnRfdGFza19pZCA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYud29ya2VyX25vZGUuc3RhdHVzID0gIklkbGUiCiAgICAgICAgICAgICAgICBzZWxmLndvcmtlcl9ub2RlLl9zdG9wX2N1cnJlbnRfdGFzayA9IEZhbHNlCiAgICAgICAgICAgICAgICB3YXJuaW5nKGYi5Lu75YuZIHt0YXNrX2lkfSDotoXmmYLlvLfliLblgZzmraLvvIh7bWF4X3dhaXRfdGltZX0g56eS77yJIikKICAgICAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuU3RvcFRhc2tFeGVjdXRpb25SZXNwb25zZSgKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzPVRydWUsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZT1mIlRhc2sge3Rhc2tfaWR9IGZvcmNlIHN0b3BwZWQgKHRpbWVvdXQgYWZ0ZXIge21heF93YWl0X3RpbWV9cykiCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpbmZvKGYi5Lu75YuZIHt0YXNrX2lkfSDlt7LmiJDlip/lgZzmraLkuKbmiZPljIXntZDmnpzvvIjogJfmmYIge3dhaXRfY291bnQ6LjFmfSDnp5LvvIkiKQogICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVwb29sX3BiMi5TdG9wVGFza0V4ZWN1dGlvblJlc3BvbnNlKAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlPWYiVGFzayB7dGFza19pZH0gc3VjY2Vzc2Z1bGx5IHN0b3BwZWQgYW5kIHJlc3VsdHMgcGFja2FnZWQgKHRvb2sge3dhaXRfY291bnQ6LjFmfXMpIgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBub2RlcG9vbF9wYjIuU3RvcFRhc2tFeGVjdXRpb25SZXNwb25zZSgKICAgICAgICAgICAgICAgIHN1Y2Nlc3M9RmFsc2UsCiAgICAgICAgICAgICAgICBtZXNzYWdlPWYiVGFzayB7dGFza19pZH0gbm90IHJ1bm5pbmciCiAgICAgICAgICAgICkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgd29ya2VyID0gV29ya2VyTm9kZSgpCiAgICAgICAgCiAgICAgICAgIyDllZ/li5UgZ1JQQyDmnI3li5kKICAgICAgICBzZXJ2ZXIgPSBncnBjLnNlcnZlcihUaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9NSkpCiAgICAgICAgbm9kZXBvb2xfcGIyX2dycGMuYWRkX1dvcmtlck5vZGVTZXJ2aWNlU2VydmljZXJfdG9fc2VydmVyKAogICAgICAgICAgICBXb3JrZXJOb2RlU2VydmljZXIod29ya2VyKSwgc2VydmVyCiAgICAgICAgKQogICAgICAgIAogICAgICAgIHNlcnZlci5hZGRfaW5zZWN1cmVfcG9ydChmJ1s6Ol06e05PREVfUE9SVH0nKQogICAgICAgIHNlcnZlci5zdGFydCgpCiAgICAgICAgCiAgICAgICAgd29ya2VyLl9sb2coZiJXb3JrZXIgTm9kZSBzdGFydGVkIG9uIHBvcnQge05PREVfUE9SVH0iKQogICAgICAgIHdvcmtlci5fbG9nKGYiRmxhc2sgVUk6IGh0dHA6Ly9sb2NhbGhvc3Q6e0ZMQVNLX1BPUlR9IikKICAgICAgICAKICAgICAgICAjIOS/neaMgemBi+ihjAogICAgICAgIHRyeToKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHNsZWVwKDYwKQogICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICAgICAgd29ya2VyLl9sb2coIlNodXR0aW5nIGRvd24uLi4iKQogICAgICAgICAgICB3b3JrZXIuX3N0b3Bfc3RhdHVzX3JlcG9ydGluZygpCiAgICAgICAgICAgIHNlcnZlci5zdG9wKGdyYWNlPTUpCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNyaXRpY2FsKGYiRmFpbGVkIHRvIHN0YXJ0IHdvcmtlcjoge2V9IikKICAgICAgICBleGl0KDEp
EOF_worker_node.py
echo '🔧 建立 ./requirements.txt ...'
base64 -d > "./requirements.txt" << 'EOF_requirements.txt'
ZG9ja2VyPT03LjEuMA0KZ3JwY2lvPT0xLjY2LjENCmdycGNpby10b29scz09MS42Ni4xDQpmbGFzaz09My4wLjMNCnBzdXRpbD09Ni4wLjANCm5ldGlmYWNlcz09MC4xMS4wDQpyZXF1ZXN0cz09Mi4zMi4z
EOF_requirements.txt
echo '🔧 建立 ./templates/login.html ...'
base64 -d > "./templates/login.html" << 'EOF_templates/login.html'
PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJ6aC1UVyI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT7lt6XkvZznr4Dpu57nmbvlhaU8L3RpdGxlPg0KICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9SW50ZXI6d2dodEA0MDA7NTAwOzYwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuMC4wL2Nzcy9hbGwubWluLmNzcyI+DQogICAgPHN0eWxlPg0KICAgICAgICA6cm9vdCB7DQogICAgICAgICAgICAtLXByaW1hcnktY29sb3I6ICM2NDc0OGI7DQogICAgICAgICAgICAtLXNlY29uZGFyeS1jb2xvcjogIzQ3NTU2OTsNCiAgICAgICAgICAgIC0tYWNjZW50LWNvbG9yOiAjMzc0MTUxOw0KICAgICAgICAgICAgLS1iYWNrZ3JvdW5kLWNvbG9yOiAjZjhmYWZjOw0KICAgICAgICAgICAgLS1jYXJkLWJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgICAgICAgICAtLXRleHQtY29sb3I6ICMxZTI5M2I7DQogICAgICAgICAgICAtLXRleHQtc2Vjb25kYXJ5OiAjNjQ3NDhiOw0KICAgICAgICAgICAgLS10ZXh0LW11dGVkOiAjOTRhM2I4Ow0KICAgICAgICAgICAgLS1ib3JkZXItY29sb3I6ICNlMmU4ZjA7DQogICAgICAgICAgICAtLWJvcmRlci1saWdodDogI2YxZjVmOTsNCiAgICAgICAgICAgIC0tZXJyb3ItY29sb3I6ICNkYzI2MjY7DQogICAgICAgICAgICAtLXN1Y2Nlc3MtY29sb3I6ICMwNTk2Njk7DQogICAgICAgICAgICAtLXdhcm5pbmctY29sb3I6ICNkOTc3MDY7DQogICAgICAgICAgICAtLXNoYWRvdy14czogMCAxcHggMnB4IDAgcmdiKDAgMCAwIC8gMC4wNSk7DQogICAgICAgICAgICAtLXNoYWRvdy1zbTogMCAxcHggM3B4IDAgcmdiKDAgMCAwIC8gMC4xKSwgMCAxcHggMnB4IC0xcHggcmdiKDAgMCAwIC8gMC4xKTsNCiAgICAgICAgICAgIC0tc2hhZG93LW1kOiAwIDRweCA2cHggLTFweCByZ2IoMCAwIDAgLyAwLjEpLCAwIDJweCA0cHggLTJweCByZ2IoMCAwIDAgLyAwLjEpOw0KICAgICAgICAgICAgLS1zaGFkb3ctbGc6IDAgMTBweCAxNXB4IC0zcHggcmdiKDAgMCAwIC8gMC4xKSwgMCA0cHggNnB4IC00cHggcmdiKDAgMCAwIC8gMC4xKTsNCiAgICAgICAgICAgIC0tZ3JhZGllbnQtc3VidGxlOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZjhmYWZjIDAlLCAjZjFmNWY5IDEwMCUpOw0KICAgICAgICB9DQoNCiAgICAgICAgKiB7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvZHkgew0KICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdJbnRlcicsIC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgIlNlZ29lIFVJIiwgUm9ib3RvLCBzYW5zLXNlcmlmOw0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgICAgICAgICBsaW5lLWhlaWdodDogMS42Ow0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgICAgICAgcGFkZGluZzogMXJlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvZHk6OmJlZm9yZSB7DQogICAgICAgICAgICBjb250ZW50OiAnJzsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMDsNCiAgICAgICAgICAgIGxlZnQ6IDA7DQogICAgICAgICAgICByaWdodDogMDsNCiAgICAgICAgICAgIGJvdHRvbTogMDsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWdyYWRpZW50LXN1YnRsZSk7DQogICAgICAgICAgICBvcGFjaXR5OiAwLjU7DQogICAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5sb2dpbi1jb250YWluZXIgew0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2FyZC1iYWNrZ3JvdW5kKTsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7DQogICAgICAgICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctbGcpOw0KICAgICAgICAgICAgcGFkZGluZzogM3JlbTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgbWF4LXdpZHRoOiA0MjBweDsNCiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1saWdodCk7DQogICAgICAgICAgICBhbmltYXRpb246IHNsaWRlVXAgMC42cyBlYXNlLW91dDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5sb2dpbi1jb250YWluZXI6OmJlZm9yZSB7DQogICAgICAgICAgICBjb250ZW50OiAnJzsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMDsNCiAgICAgICAgICAgIGxlZnQ6IDA7DQogICAgICAgICAgICByaWdodDogMDsNCiAgICAgICAgICAgIGhlaWdodDogMXB4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCB0cmFuc3BhcmVudCAwJSwgdmFyKC0tYm9yZGVyLWNvbG9yKSA1MCUsIHRyYW5zcGFyZW50IDEwMCUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLmxvZ2luLWhlYWRlciB7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyLjVyZW07DQogICAgICAgIH0NCg0KICAgICAgICAubG9naW4taGVhZGVyIC5pY29uIHsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMi41cmVtOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMXJlbTsNCiAgICAgICAgICAgIG9wYWNpdHk6IDAuODsNCiAgICAgICAgfQ0KDQogICAgICAgIC5sb2dpbi1oZWFkZXIgaDEgew0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjg3NXJlbTsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjVyZW07DQogICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogLTAuMDI1ZW07DQogICAgICAgIH0NCg0KICAgICAgICAubG9naW4taGVhZGVyIHAgew0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtc2Vjb25kYXJ5KTsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC45NXJlbTsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQogICAgICAgIH0NCg0KICAgICAgICAuc3RhdHVzLW1lc3NhZ2Ugew0KICAgICAgICAgICAgcGFkZGluZzogMC44NzVyZW0gMXJlbTsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEuNXJlbTsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgICAgICAgICBmb250LXNpemU6IDAuODc1cmVtOw0KICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQ7DQogICAgICAgIH0NCg0KICAgICAgICAuZXJyb3ItbWVzc2FnZSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmVmMmYyOw0KICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjZmVjYWNhOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5zdWNjZXNzLW1lc3NhZ2Ugew0KICAgICAgICAgICAgYmFja2dyb3VuZDogI2VjZmRmNTsNCiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogI2E3ZjNkMDsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5pbmZvLW1lc3NhZ2Ugew0KICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y4ZmFmYzsNCiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LXNlY29uZGFyeSk7DQogICAgICAgIH0NCg0KICAgICAgICAuZm9ybS1ncm91cCB7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxLjI1cmVtOw0KICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgICB9DQoNCiAgICAgICAgLmZvcm0tZ3JvdXAgbGFiZWwgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOw0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC41cmVtOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjg3NXJlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5pbnB1dC13cmFwcGVyIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5pbnB1dC13cmFwcGVyIGkgew0KICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgICAgICAgbGVmdDogMC44NzVyZW07DQogICAgICAgICAgICB0b3A6IDUwJTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMXJlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5mb3JtLWdyb3VwIGlucHV0IHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgcGFkZGluZzogMC44NzVyZW0gMC44NzVyZW0gMC44NzVyZW0gMi41cmVtOw0KICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC45NXJlbTsNCiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgICAgICB9DQoNCiAgICAgICAgLmZvcm0tZ3JvdXAgaW5wdXQ6OnBsYWNlaG9sZGVyIHsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5mb3JtLWdyb3VwIGlucHV0OmZvY3VzIHsNCiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgICAgICAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYigxMDAgMTE2IDEzOSAvIDAuMSk7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLnN1Ym1pdC1idG4gew0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBwYWRkaW5nOiAwLjg3NXJlbTsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtY29sb3IpOw0KICAgICAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjk1cmVtOw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQogICAgICAgICAgICBtYXJnaW4tdG9wOiAwLjVyZW07DQogICAgICAgIH0NCg0KICAgICAgICAuc3VibWl0LWJ0bjpob3ZlciB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsNCiAgICAgICAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1tZCk7DQogICAgICAgIH0NCg0KICAgICAgICAuc3VibWl0LWJ0bjphY3RpdmUgew0KICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOw0KICAgICAgICB9DQoNCiAgICAgICAgLmZvb3Rlci10ZXh0IHsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIG1hcmdpbi10b3A6IDJyZW07DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgICAgICAgICBmb250LXNpemU6IDAuODEyNXJlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIEBrZXlmcmFtZXMgc2xpZGVVcCB7DQogICAgICAgICAgICBmcm9tIHsNCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwOw0KICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgyMHB4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRvIHsNCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxOw0KICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA0ODBweCkgew0KICAgICAgICAgICAgLmxvZ2luLWNvbnRhaW5lciB7DQogICAgICAgICAgICAgICAgbWFyZ2luOiAxcmVtOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDJyZW07DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5sb2dpbi1oZWFkZXIgaDEgew0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMS41cmVtOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KICAgIDxkaXYgY2xhc3M9ImxvZ2luLWNvbnRhaW5lciI+DQogICAgICAgIDxkaXYgY2xhc3M9ImxvZ2luLWhlYWRlciI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpY29uIj4NCiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNlcnZlciI+PC9pPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8aDE+5bel5L2c56+A6bue55m75YWlPC9oMT4NCiAgICAgICAgICAgIDxwPumAo+aOpeWIsCBIaXZlTWluZCDliIbmlaPlvI/oqIjnrpfntrLot688L3A+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIHslIGlmIGN1cnJlbnRfc3RhdHVzICV9DQogICAgICAgIDxkaXYgY2xhc3M9InN0YXR1cy1tZXNzYWdlIHslIGlmICdFcnJvcicgaW4gY3VycmVudF9zdGF0dXMgJX1lcnJvci1tZXNzYWdleyUgZWxpZiAnSWRsZScgaW4gY3VycmVudF9zdGF0dXMgJX1zdWNjZXNzLW1lc3NhZ2V7JSBlbHNlICV9aW5mby1tZXNzYWdleyUgZW5kaWYgJX0iPg0KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1pbmZvLWNpcmNsZSI+PC9pPg0KICAgICAgICAgICAg56+A6bue54uA5oWLOiB7eyBjdXJyZW50X3N0YXR1cyB9fQ0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgeyUgZW5kaWYgJX0NCg0KICAgICAgICB7JSBpZiBlcnJvciAlfQ0KICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMtbWVzc2FnZSBlcnJvci1tZXNzYWdlIj4NCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tY2lyY2xlIj48L2k+DQogICAgICAgICAgICB7eyBlcnJvciB9fQ0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgeyUgZW5kaWYgJX0NCg0KICAgICAgICA8Zm9ybSBtZXRob2Q9InBvc3QiIGFjdGlvbj0ie3sgdXJsX2ZvcignbG9naW5fcm91dGUnKSB9fSI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1c2VybmFtZSI+DQogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlciI+PC9pPg0KICAgICAgICAgICAgICAgICAgICDnlKjmiLblkI3nqLENCiAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LXdyYXBwZXIiPg0KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXVzZXIiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ1c2VybmFtZSIgbmFtZT0idXNlcm5hbWUiIHJlcXVpcmVkIGF1dG9jb21wbGV0ZT0idXNlcm5hbWUiIHBsYWNlaG9sZGVyPSLoq4vovLjlhaXmgqjnmoTnlKjmiLblkI0iPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwYXNzd29yZCI+DQogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbG9jayI+PC9pPg0KICAgICAgICAgICAgICAgICAgICDlr4bnorwNCiAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LXdyYXBwZXIiPg0KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWxvY2siPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBpZD0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZCBhdXRvY29tcGxldGU9ImN1cnJlbnQtcGFzc3dvcmQiIHBsYWNlaG9sZGVyPSLoq4vovLjlhaXmgqjnmoTlr4bnorwiPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9InN1Ym1pdC1idG4iPg0KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2lnbi1pbi1hbHQiPjwvaT4NCiAgICAgICAgICAgICAgICDnmbvlhaXkuKboqLvlhornr4Dpu54NCiAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICA8L2Zvcm0+DQoNCiAgICAgICAgPGRpdiBjbGFzcz0iZm9vdGVyLXRleHQiPg0KICAgICAgICAgICAg55m75YWl5b6M5bCH6Ieq5YuV6Ki75YaK5q2k6Kit5YKZ54K65bel5L2c56+A6buePGJyPg0KICAgICAgICAgICAgPHNtYWxsIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7IGZvbnQtc2l6ZTogMC43NXJlbTsiPg0KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbWFwLW1hcmtlci1hbHQiPjwvaT4NCiAgICAgICAgICAgICAgICDlpoLpnIDkv67mlLnlnLDljYDoqK3lrprvvIzoq4vph43mlrDllZ/li5Xnr4Dpu57nqIvlvI8NCiAgICAgICAgICAgIDwvc21hbGw+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KPC9ib2R5Pg0KPC9odG1sPg==
EOF_templates/login.html
echo '🔧 建立 ./templates/monitor.html ...'
base64 -d > "./templates/monitor.html" << 'EOF_templates/monitor.html'
PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InpoLVRXIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+5bel5L2c56+A6bue55uj5o6nIC0ge3sgbm9kZV9pZCB9fTwvdGl0bGU+CiAgICA8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PUludGVyOndnaHRANDAwOzUwMDs2MDA7NzAwJmRpc3BsYXk9c3dhcCIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U0YrTW9ubzp3Z2h0QDQwMDs1MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9mb250LWF3ZXNvbWUvNi4wLjAvY3NzL2FsbC5taW4uY3NzIj4KICAgIDxzdHlsZT4KICAgICAgICAvKiDln7rnpI7mqKPlvI8gKi8KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgOnJvb3QgewogICAgICAgICAgICAtLXByaW1hcnktY29sb3I6ICM2NDc0OGI7CiAgICAgICAgICAgIC0tc2Vjb25kYXJ5LWNvbG9yOiAjNDc1NTY5OwogICAgICAgICAgICAtLWFjY2VudC1jb2xvcjogIzM3NDE1MTsKICAgICAgICAgICAgLS1zdWNjZXNzLWNvbG9yOiAjMDU5NjY5OwogICAgICAgICAgICAtLXdhcm5pbmctY29sb3I6ICNkOTc3MDY7CiAgICAgICAgICAgIC0tZXJyb3ItY29sb3I6ICNkYzI2MjY7CiAgICAgICAgICAgIC0tYmFja2dyb3VuZC1jb2xvcjogI2Y4ZmFmYzsKICAgICAgICAgICAgLS1jYXJkLWJhY2tncm91bmQ6ICNmZmZmZmY7CiAgICAgICAgICAgIC0tY2FyZC1iYWNrZ3JvdW5kLWxpZ2h0OiAjZjhmYWZjOwogICAgICAgICAgICAtLXRleHQtcHJpbWFyeTogIzFlMjkzYjsKICAgICAgICAgICAgLS10ZXh0LXNlY29uZGFyeTogIzY0NzQ4YjsKICAgICAgICAgICAgLS10ZXh0LW11dGVkOiAjOTRhM2I4OwogICAgICAgICAgICAtLWJvcmRlci1jb2xvcjogI2UyZThmMDsKICAgICAgICAgICAgLS1ib3JkZXItbGlnaHQ6ICNmMWY1Zjk7CiAgICAgICAgICAgIC0tc2hhZG93LXhzOiAwIDFweCAycHggMCByZ2IoMCAwIDAgLyAwLjA1KTsKICAgICAgICAgICAgLS1zaGFkb3ctc206IDAgMXB4IDNweCAwIHJnYigwIDAgMCAvIDAuMSksIDAgMXB4IDJweCAtMXB4IHJnYigwIDAgMCAvIDAuMSk7CiAgICAgICAgICAgIC0tc2hhZG93LW1kOiAwIDRweCA2cHggLTFweCByZ2IoMCAwIDAgLyAwLjEpLCAwIDJweCA0cHggLTJweCByZ2IoMCAwIDAgLyAwLjEpOwogICAgICAgICAgICAtLXNoYWRvdy1sZzogMCAxMHB4IDE1cHggLTNweCByZ2IoMCAwIDAgLyAwLjEpLCAwIDRweCA2cHggLTRweCByZ2IoMCAwIDAgLyAwLjEpOwogICAgICAgICAgICAtLWdyYWRpZW50LXN1YnRsZTogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2Y4ZmFmYyAwJSwgI2YxZjVmOSAxMDAlKTsKICAgICAgICAgICAgLS1ib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICAtLWJvcmRlci1yYWRpdXMtc206IDhweDsKICAgICAgICB9CgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogJ0ludGVyJywgLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAiU2Vnb2UgVUkiLCBSb2JvdG8sICJIZWx2ZXRpY2EgTmV1ZSIsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtcHJpbWFyeSk7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjY7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgcGFkZGluZzogMjRweDsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgfQoKICAgICAgICAuY29udGFpbmVyIHsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxNDAwcHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1ib3JkZXItcmFkaXVzKTsKICAgICAgICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LWxnKTsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsKICAgICAgICB9CgogICAgICAgIC8qIOmgremDqOaoo+W8jyAqLwogICAgICAgIC5oZWFkZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ncmFkaWVudC1zdWJ0bGUpOwogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KTsKICAgICAgICAgICAgcGFkZGluZzogMnJlbTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgLmhlYWRlciBoMSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS44NzVyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiAwLjc1cmVtOwogICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogLTAuMDI1ZW07CiAgICAgICAgfQoKICAgICAgICAuaGVhZGVyIGgxOjpiZWZvcmUgewogICAgICAgICAgICBjb250ZW50OiAn8J+Wpe+4jyc7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4yNXJlbTsKICAgICAgICAgICAgb3BhY2l0eTogMC43OwogICAgICAgIH0KCiAgICAgICAgLmhlYWRlci1yaWdodCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMXJlbTsKICAgICAgICB9CgogICAgICAgIC51c2VyLWluZm8gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOwogICAgICAgICAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTBweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjg3NXJlbTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsKICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtc2Vjb25kYXJ5KTsKICAgICAgICB9CgogICAgICAgIC5sb2dvdXQtYnRuIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tdGV4dC1wcmltYXJ5KTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NzVyZW07CiAgICAgICAgfQoKICAgICAgICAubG9nb3V0LWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktY29sb3IpOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgICAgfQoKICAgICAgICAvKiDlhaflrrnntrLmoLwgKi8KICAgICAgICAuY29udGVudC1ncmlkIHsKICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOwogICAgICAgICAgICBnYXA6IDEuNXJlbTsKICAgICAgICAgICAgcGFkZGluZzogMnJlbTsKICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1jb2xvcik7CiAgICAgICAgfQoKICAgICAgICAuY29udGVudC1ncmlkIC5jYXJkOmxhc3QtY2hpbGQgewogICAgICAgICAgICBncmlkLWNvbHVtbjogMSAvIC0xOwogICAgICAgIH0KCiAgICAgICAgLyog5Y2h54mH5qij5byPICovCiAgICAgICAgLmNhcmQgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1ib3JkZXItcmFkaXVzKTsKICAgICAgICAgICAgcGFkZGluZzogMS41cmVtOwogICAgICAgICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctc20pOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgIH0KCiAgICAgICAgLmNhcmQ6aG92ZXIgewogICAgICAgICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctbWQpOwogICAgICAgICAgICBib3JkZXItY29sb3I6IHZhcigtLWJvcmRlci1jb2xvcik7CiAgICAgICAgfQoKICAgICAgICAuY2FyZCBoMiB7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LXByaW1hcnkpOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxLjVyZW07CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4yNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiAwLjVyZW07CiAgICAgICAgfQoKICAgICAgICAuY2FyZCBoMjo6YmVmb3JlIHsKICAgICAgICAgICAgY29udGVudDogYXR0cihkYXRhLWljb24pOwogICAgICAgICAgICBmb250LXNpemU6IDFyZW07CiAgICAgICAgICAgIG9wYWNpdHk6IDAuNzsKICAgICAgICB9CgogICAgICAgIC8qIOihqOagvOaoo+W8jyAqLwogICAgICAgIC50YWJsZSB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmFja2dyb3VuZCk7CiAgICAgICAgfQoKICAgICAgICAudGFibGUgdGgsCiAgICAgICAgLnRhYmxlIHRkIHsKICAgICAgICAgICAgcGFkZGluZzogMC44NzVyZW07CiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItbGlnaHQpOwogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgICAgIH0KCiAgICAgICAgLnRhYmxlIHRoIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2FyZC1iYWNrZ3JvdW5kLWxpZ2h0KTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtc2Vjb25kYXJ5KTsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjgxMjVyZW07CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA1ZW07CiAgICAgICAgfQoKICAgICAgICAudGFibGUgdGQgewogICAgICAgICAgICBmb250LXdlaWdodDogNDAwOwogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KTsKICAgICAgICB9CgogICAgICAgIC50YWJsZSB0cjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmFja2dyb3VuZC1saWdodCk7CiAgICAgICAgfQoKICAgICAgICAvKiDmjInpiJXmqKPlvI8gKi8KICAgICAgICAucmVmcmVzaC1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jYXJkLWJhY2tncm91bmQpOwogICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1zZWNvbmRhcnkpOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogICAgICAgICAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44MTI1cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDAuNXJlbTsKICAgICAgICB9CgogICAgICAgIC5yZWZyZXNoLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXRleHQtcHJpbWFyeSk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB2YXIoLS10ZXh0LXByaW1hcnkpOwogICAgICAgIH0KCiAgICAgICAgLyog5pel6KqM5qij5byPICovCiAgICAgICAgLmxvZ3MgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS10ZXh0LXByaW1hcnkpOwogICAgICAgICAgICBjb2xvcjogI2Y4ZmFmYzsKICAgICAgICAgICAgcGFkZGluZzogMS41cmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1ib3JkZXItcmFkaXVzLXNtKTsKICAgICAgICAgICAgbWF4LWhlaWdodDogNTAwcHg7CiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnU0YgTW9ubycsICdNb25hY28nLCAnQ2FzY2FkaWEgQ29kZScsICdSb2JvdG8gTW9ubycsIENvbnNvbGFzLCBtb25vc3BhY2U7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44MTI1cmVtOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS42OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAzMDBweDsKICAgICAgICB9CgogICAgICAgIC5sb2ctZW50cnkgewogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjVyZW07CiAgICAgICAgICAgIHBhZGRpbmc6IDAuMjVyZW0gMDsKICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIG9wYWNpdHk6IDAuOTsKICAgICAgICB9CgogICAgICAgIC5sb2ctZW50cnk6aG92ZXIgewogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuMjVyZW0gMC41cmVtOwogICAgICAgICAgICBtYXJnaW46IDAuMjVyZW0gLTAuNXJlbTsKICAgICAgICB9CgogICAgICAgIC8qIOeLgOaFi+aomeexpCAqLwogICAgICAgIC5zdGF0dXMgewogICAgICAgICAgICBwYWRkaW5nOiAwLjI1cmVtIDAuNzVyZW07CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwcHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDVlbTsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMC4yNXJlbTsKICAgICAgICB9CgogICAgICAgIC5zdGF0dXMuaWRsZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlY2ZkZjU7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2E3ZjNkMDsKICAgICAgICB9CgogICAgICAgIC5zdGF0dXMucnVubmluZywKICAgICAgICAuc3RhdHVzLmV4ZWN1dGluZyB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlZmY2ZmY7CiAgICAgICAgICAgIGNvbG9yOiAjMjU2M2ViOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjOTNjNWZkOwogICAgICAgIH0KCiAgICAgICAgLnN0YXR1cy5lcnJvciwKICAgICAgICAuc3RhdHVzLmZhaWxlZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZWYyZjI7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNmZWNhY2E7CiAgICAgICAgfQoKICAgICAgICAuc3RhdHVzLnBlbmRpbmcgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmYmViOwogICAgICAgICAgICBjb2xvcjogdmFyKC0td2FybmluZy1jb2xvcik7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNmZWQ3YWE7CiAgICAgICAgfQoKICAgICAgICAvKiDmlbjmk5rlj6/oppbljJblop7lvLcgKi8KICAgICAgICAubWV0cmljLWNhcmQgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmFja2dyb3VuZC1saWdodCk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMtc20pOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgLm1ldHJpYy1pY29uIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIG9wYWNpdHk6IDAuNzsKICAgICAgICB9CgogICAgICAgIC5tZXRyaWMtY29udGVudCBoMyB7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LXByaW1hcnkpOwogICAgICAgIH0KCiAgICAgICAgLm1ldHJpYy1jb250ZW50IHAgewogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LXNlY29uZGFyeSk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44MTI1cmVtOwogICAgICAgIH0KCiAgICAgICAgLyog5ZyW6KGo5a655ZmoICovCiAgICAgICAgLmNoYXJ0LWNvbnRhaW5lciB7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEuNXJlbTsKICAgICAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2FyZC1iYWNrZ3JvdW5kLWxpZ2h0KTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYm9yZGVyLXJhZGl1cy1zbSk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICAgICAgaGVpZ2h0OiAyNTBweDsKICAgICAgICB9CgogICAgICAgIC8qIOmfv+aHieW8j+ioreioiCAqLwogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiAxMDI0cHgpIHsKICAgICAgICAgICAgLmNvbnRlbnQtZ3JpZCB7CiAgICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmcjsKICAgICAgICAgICAgICAgIGdhcDogMXJlbTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmNvbnRlbnQtZ3JpZCAuY2FyZDpsYXN0LWNoaWxkIHsKICAgICAgICAgICAgICAgIGdyaWQtY29sdW1uOiAxOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgICAgICAgICAgYm9keSB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNnB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAuaGVhZGVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEuNXJlbTsKICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5oZWFkZXItcmlnaHQgewogICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IHJvdzsKICAgICAgICAgICAgICAgIGdhcDogMC43NXJlbTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmNvbnRlbnQtZ3JpZCB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxLjVyZW07CiAgICAgICAgICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5jYXJkIHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEuMjVyZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC5oZWFkZXIgaDEgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgICAgICAgICA8aDE+5bel5L2c56+A6bue55uj5o6n6Z2i5p2/PC9oMT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyLXJpZ2h0Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InVzZXItaW5mbyI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS11c2VyIj48L2k+CiAgICAgICAgICAgICAgICAgICAge3sgdXNlcm5hbWUgfX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGEgaHJlZj0iL2xvZ291dCIgY2xhc3M9ImxvZ291dC1idG4iPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2lnbi1vdXQtYWx0Ij48L2k+CiAgICAgICAgICAgICAgICAgICAg55m75Ye6CiAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWdyaWQiPgogICAgICAgICAgICA8IS0tIOevgOm7nueLgOaFi+WNoeeJhyAtLT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICA8aDIgZGF0YS1pY29uPT7nr4Dpu57ni4DmhYs8L2gyPgogICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJ0YWJsZSI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS10YWciPjwvaT4g56+A6bueSUQ8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgaWQ9Im5vZGUtaWQiPnt7IG5vZGVfaWQgfX08L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1jaXJjbGUiPjwvaT4g54uA5oWLPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkPjxzcGFuIGlkPSJ0YXNrLXN0YXR1cyIgY2xhc3M9InN0YXR1cyI+e3sgaW5pdGlhbF9zdGF0dXMgfX08L3NwYW4+PC90ZD4KICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtdGFza3MiPjwvaT4g55W25YmN5Lu75YuZPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGlkPSJ0YXNrLWlkIj5Ob25lPC90ZD4KICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoPjxpIGNsYXNzPSJmYXMgZmEtY29pbnMiPjwvaT4gQ1BUIOmkmOmhjTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBpZD0iY3B0LWJhbGFuY2UiPjA8L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1uZXR3b3JrLXdpcmVkIj48L2k+IOacrOapn0lQPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGlkPSJpcC1hZGRyZXNzIj7mqqLmuKzkuK0uLi48L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGg+PGkgY2xhc3M9ImZhcyBmYS1taWNyb2NoaXAiPjwvaT4gQ1BVIOS9v+eUqOeOhzwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBpZD0iY3B1LXVzYWdlIj4wJTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aD48aSBjbGFzcz0iZmFzIGZhLW1lbW9yeSI+PC9pPiDoqJjmhrbpq5Tkvb/nlKjnjoc8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgaWQ9Im1lbW9yeS11c2FnZSI+MCU8L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwhLS0g57O757Wx6LOH5rqQ5Y2h54mHIC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1pY29uPT7ns7vntbHos4fmupA8L2gyPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDwhLS0gQ1BVIOS9v+eUqOeOhyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1ldHJpYy1jYXJkIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtZXRyaWMtaWNvbiI+4pqhPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWV0cmljLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDMgaWQ9ImNwdS1tZXRyaWMiPjAlPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+Q1BVIOS9v+eUqOeOhzwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8IS0tIOiomOaGtumrlOS9v+eUqOeOhyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1ldHJpYy1jYXJkIiBzdHlsZT0ibWFyZ2luLXRvcDogMXJlbTsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1ldHJpYy1pY29uIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtZXRyaWMtY29udGVudCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBpZD0ibWVtb3J5LW1ldHJpYyI+MCU8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICA8cD7oqJjmhrbpq5Tkvb/nlKjnjoc8L3A+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPCEtLSDlnJbooajljYDln58gLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1jb250YWluZXIiPgogICAgICAgICAgICAgICAgICAgIDxjYW52YXMgaWQ9ImNwdUNoYXJ0Ij48L2NhbnZhcz4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY29udGFpbmVyIj4KICAgICAgICAgICAgICAgICAgICA8Y2FudmFzIGlkPSJtZW1vcnlDaGFydCI+PC9jYW52YXM+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8IS0tIOezu+e1seaXpeiqjOWNoeeJhyAtLT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtaWNvbj0+57O757Wx5pel6KqMPC9oMj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJyZWZyZXNoLWJ0biIgb25jbGljaz0icmVmcmVzaExvZ3MoKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3luYy1hbHQiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAg5Yi35paw5pel6KqMCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImxvZ3MiIGNsYXNzPSJsb2dzIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciIgc3R5bGU9Im9wYWNpdHk6IDAuNzsiPui8ieWFpeaXpeiqjOS4rS4uLjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0zLjYuMC5taW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vY2hhcnQuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9Ii9zdGF0aWMvanMvbW9uaXRvci5qcyI+PC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==
EOF_templates/monitor.html
echo '🔧 建立 ./nodepool.proto ...'
base64 -d > "./nodepool.proto" << 'EOF_nodepool.proto'
c3ludGF4ID0gInByb3RvMyI7CgpwYWNrYWdlIG5vZGVwb29sOwoKLy8g6KiK5oGv5a6a576pCm1lc3NhZ2UgTG9naW5SZXF1ZXN0IHsKICAgIHN0cmluZyB1c2VybmFtZSA9IDE7CiAgICBzdHJpbmcgcGFzc3dvcmQgPSAyOwp9CgptZXNzYWdlIExvZ2luUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIHN0cmluZyB0b2tlbiA9IDM7Cn0KCm1lc3NhZ2UgVHJhbnNmZXJSZXF1ZXN0IHsKICAgIHN0cmluZyB0b2tlbiA9IDE7CiAgICBzdHJpbmcgcmVjZWl2ZXJfdXNlcm5hbWUgPSAyOwogICAgaW50NjQgYW1vdW50ID0gMzsKfQoKbWVzc2FnZSBUcmFuc2ZlclJlc3BvbnNlIHsKICAgIGJvb2wgc3VjY2VzcyA9IDE7CiAgICBzdHJpbmcgbWVzc2FnZSA9IDI7Cn0KCm1lc3NhZ2UgR2V0QmFsYW5jZVJlcXVlc3QgewogICAgc3RyaW5nIHVzZXJuYW1lID0gMTsKICAgIHN0cmluZyB0b2tlbiA9IDI7ICAvLyDmlrDlop7pgJnkuIDooYwKfQoKbWVzc2FnZSBHZXRCYWxhbmNlUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIGludDY0IGJhbGFuY2UgPSAzOwp9CgptZXNzYWdlIFJlZ2lzdGVyV29ya2VyTm9kZVJlcXVlc3QgewogICAgc3RyaW5nIG5vZGVfaWQgPSAxOwogICAgc3RyaW5nIGhvc3RuYW1lID0gMjsKICAgIGludDMyIGNwdV9jb3JlcyA9IDM7CiAgICBpbnQzMiBtZW1vcnlfZ2IgPSA0OwogICAgaW50MzIgY3B1X3Njb3JlID0gNTsKICAgIGludDMyIGdwdV9zY29yZSA9IDY7CiAgICBpbnQzMiBncHVfbWVtb3J5X2diID0gNzsKICAgIHN0cmluZyBsb2NhdGlvbiA9IDg7CiAgICBpbnQzMiBwb3J0ID0gOTsKICAgIHN0cmluZyBncHVfbmFtZSA9IDEyOwp9CgptZXNzYWdlIFN0YXR1c1Jlc3BvbnNlIHsKICAgIGJvb2wgc3VjY2VzcyA9IDE7CiAgICBzdHJpbmcgbWVzc2FnZSA9IDI7Cn0KCm1lc3NhZ2UgSGVhbHRoQ2hlY2tSZXF1ZXN0IHt9CgptZXNzYWdlIEhlYWx0aENoZWNrUmVzcG9uc2UgewogICAgYm9vbCBoZWFsdGh5ID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKfQoKbWVzc2FnZSBSZXBvcnRTdGF0dXNSZXF1ZXN0IHsKICAgIHN0cmluZyBub2RlX2lkID0gMTsKICAgIHN0cmluZyBzdGF0dXNfbWVzc2FnZSA9IDI7Cn0KCm1lc3NhZ2UgV29ya2VyTm9kZUluZm8gewogICAgc3RyaW5nIG5vZGVfaWQgPSAxOwogICAgc3RyaW5nIGhvc3RuYW1lID0gMjsKICAgIGludDMyIGNwdV9jb3JlcyA9IDM7CiAgICBpbnQzMiBtZW1vcnlfZ2IgPSA0OwogICAgc3RyaW5nIHN0YXR1cyA9IDU7CiAgICBkb3VibGUgbGFzdF9oZWFydGJlYXQgPSA2OwogICAgaW50MzIgY3B1X3Njb3JlID0gNzsKICAgIGludDMyIGdwdV9zY29yZSA9IDg7CiAgICBpbnQzMiBncHVfbWVtb3J5X2diID0gOTsKICAgIHN0cmluZyBsb2NhdGlvbiA9IDEwOwogICAgaW50MzIgcG9ydCA9IDExOwogICAgc3RyaW5nIGdwdV9uYW1lID0gMTI7Cn0KCm1lc3NhZ2UgR2V0Tm9kZUxpc3RSZXF1ZXN0IHt9CgptZXNzYWdlIEdldE5vZGVMaXN0UmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIHJlcGVhdGVkIFdvcmtlck5vZGVJbmZvIG5vZGVzID0gMzsKfQoKbWVzc2FnZSBVcGxvYWRUYXNrUmVxdWVzdCB7CiAgICBzdHJpbmcgdGFza19pZCA9IDE7CiAgICBieXRlcyB0YXNrX3ppcCA9IDI7CiAgICBpbnQzMiBtZW1vcnlfZ2IgPSAzOwogICAgaW50MzIgY3B1X3Njb3JlID0gNDsKICAgIGludDMyIGdwdV9zY29yZSA9IDU7CiAgICBpbnQzMiBncHVfbWVtb3J5X2diID0gNjsKICAgIHN0cmluZyBsb2NhdGlvbiA9IDc7CiAgICBzdHJpbmcgZ3B1X25hbWUgPSA4OwogICAgc3RyaW5nIHVzZXJfaWQgPSA5OyAgLy8g5re75Yqg55So5oi2SUTlrZfmrrUKfQoKbWVzc2FnZSBVcGxvYWRUYXNrUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKfQoKbWVzc2FnZSBQb2xsVGFza1N0YXR1c1JlcXVlc3QgewogICAgc3RyaW5nIHRhc2tfaWQgPSAxOwp9CgptZXNzYWdlIFBvbGxUYXNrU3RhdHVzUmVzcG9uc2UgewogICAgc3RyaW5nIHRhc2tfaWQgPSAxOyAvLyBGaXhlZCB0eXBvIGZyb20gJ9GA0YPQutCwX2lkJwogICAgc3RyaW5nIHN0YXR1cyA9IDI7CiAgICByZXBlYXRlZCBzdHJpbmcgb3V0cHV0ID0gMzsKICAgIHN0cmluZyBtZXNzYWdlID0gNDsKfQoKbWVzc2FnZSBTdG9yZU91dHB1dFJlcXVlc3QgewogICAgc3RyaW5nIHRhc2tfaWQgPSAxOwogICAgc3RyaW5nIG91dHB1dCA9IDI7Cn0KCm1lc3NhZ2UgU3RvcmVSZXN1bHRSZXF1ZXN0IHsKICAgIHN0cmluZyB0YXNrX2lkID0gMTsKICAgIGJ5dGVzIHJlc3VsdF96aXAgPSAyOwp9CgptZXNzYWdlIEdldFRhc2tSZXN1bHRSZXF1ZXN0IHsKICAgIHN0cmluZyB0YXNrX2lkID0gMTsKICAgIHN0cmluZyB0b2tlbiA9IDI7ICAvLyDnlKjmiLbku6TniYzvvIznlKjmlrzpqZforYkKfQoKbWVzc2FnZSBHZXRUYXNrUmVzdWx0UmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIGJ5dGVzIHJlc3VsdF96aXAgPSAzOwp9CgptZXNzYWdlIFJldHVyblRhc2tSZXN1bHRSZXF1ZXN0IHsKICAgIHN0cmluZyB0YXNrX2lkID0gMTsKICAgIGJ5dGVzIHJlc3VsdF96aXAgPSAyOwp9CgptZXNzYWdlIFJldHVyblRhc2tSZXN1bHRSZXNwb25zZSB7CiAgICBib29sIHN1Y2Nlc3MgPSAxOwogICAgc3RyaW5nIG1lc3NhZ2UgPSAyOwp9CgptZXNzYWdlIEV4ZWN1dGVUYXNrUmVxdWVzdCB7CiAgICBzdHJpbmcgbm9kZV9pZCA9IDE7CiAgICBzdHJpbmcgdGFza19pZCA9IDI7CiAgICBieXRlcyB0YXNrX3ppcCA9IDM7Cn0KCm1lc3NhZ2UgRXhlY3V0ZVRhc2tSZXNwb25zZSB7CiAgICBib29sIHN1Y2Nlc3MgPSAxOwogICAgc3RyaW5nIG1lc3NhZ2UgPSAyOwogICAgYnl0ZXMgcmVzdWx0ID0gMzsKfQoKbWVzc2FnZSBSZXBvcnRPdXRwdXRSZXF1ZXN0IHsKICAgIHN0cmluZyBub2RlX2lkID0gMTsKICAgIHN0cmluZyB0YXNrX2lkID0gMjsKICAgIHN0cmluZyBvdXRwdXQgPSAzOwp9CgptZXNzYWdlIFJ1bm5pbmdTdGF0dXNSZXF1ZXN0IHsKICAgIHN0cmluZyBub2RlX2lkID0gMTsKICAgIHN0cmluZyB0YXNrX2lkID0gMjsKfQoKbWVzc2FnZSBSdW5uaW5nU3RhdHVzUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIGludDY0IGNwdF9yZXdhcmQgPSAzOwp9CgptZXNzYWdlIFRhc2tDb21wbGV0ZWRSZXF1ZXN0IHsKICAgIHN0cmluZyB0YXNrX2lkID0gMTsKICAgIHN0cmluZyBub2RlX2lkID0gMjsKICAgIGJvb2wgc3VjY2VzcyA9IDM7Cn0KCm1lc3NhZ2UgU3RvcmVMb2dzUmVxdWVzdCB7CiAgICBzdHJpbmcgbm9kZV9pZCA9IDE7CiAgICBzdHJpbmcgdGFza19pZCA9IDI7CiAgICBzdHJpbmcgbG9ncyA9IDM7ICAvLyBKU09OIOagvOW8j+eahOaXpeiqjOaVuOaTmgogICAgaW50NjQgdGltZXN0YW1wID0gNDsKfQoKbWVzc2FnZSBHZXRUYXNrTG9nc1JlcXVlc3QgewogICAgc3RyaW5nIHRhc2tfaWQgPSAxOwogICAgc3RyaW5nIHRva2VuID0gMjsgIC8vIOeUqOaItuS7pOeJjO+8jOeUqOaWvOmpl+itiQp9CgptZXNzYWdlIEdldFRhc2tMb2dzUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKICAgIHN0cmluZyBsb2dzID0gMzsgIC8vIEpTT04g5qC85byP55qE5pel6KqM5pW45pOaCn0KCm1lc3NhZ2UgR2V0QWxsVGFza3NSZXF1ZXN0IHsKICAgIHN0cmluZyB0b2tlbiA9IDE7Cn0KCm1lc3NhZ2UgVGFza1N0YXR1cyB7CiAgICBzdHJpbmcgdGFza19pZCA9IDE7CiAgICBzdHJpbmcgc3RhdHVzID0gMjsKICAgIHN0cmluZyBjcmVhdGVkX2F0ID0gMzsKICAgIHN0cmluZyB1cGRhdGVkX2F0ID0gNDsKICAgIHN0cmluZyBhc3NpZ25lZF9ub2RlID0gNTsKfQoKbWVzc2FnZSBHZXRBbGxUYXNrc1Jlc3BvbnNlIHsKICAgIGJvb2wgc3VjY2VzcyA9IDE7CiAgICBzdHJpbmcgbWVzc2FnZSA9IDI7CiAgICByZXBlYXRlZCBUYXNrU3RhdHVzIHRhc2tzID0gMzsKfQoKbWVzc2FnZSBTdG9wVGFza1JlcXVlc3QgewogICAgc3RyaW5nIHRhc2tfaWQgPSAxOwogICAgc3RyaW5nIHRva2VuID0gMjsgICAgICAvLyDnlKjmiLbku6TniYzvvIznlKjmlrzpqZforYnmrIrpmZAKfQoKbWVzc2FnZSBTdG9wVGFza1Jlc3BvbnNlIHsKICAgIGJvb2wgc3VjY2VzcyA9IDE7CiAgICBzdHJpbmcgbWVzc2FnZSA9IDI7Cn0KCi8vIOW3peS9nOevgOm7nuWBnOatouS7u+WLmeWft+ihjOeahOa2iOaBrwptZXNzYWdlIFN0b3BUYXNrRXhlY3V0aW9uUmVxdWVzdCB7CiAgICBzdHJpbmcgdGFza19pZCA9IDE7Cgp9CgptZXNzYWdlIFN0b3BUYXNrRXhlY3V0aW9uUmVzcG9uc2UgewogICAgYm9vbCBzdWNjZXNzID0gMTsKICAgIHN0cmluZyBtZXNzYWdlID0gMjsKfQoKLy8g5pyN5YuZ5a6a576pCnNlcnZpY2UgVXNlclNlcnZpY2UgewogICAgcnBjIExvZ2luKExvZ2luUmVxdWVzdCkgcmV0dXJucyAoTG9naW5SZXNwb25zZSk7CiAgICBycGMgVHJhbnNmZXIoVHJhbnNmZXJSZXF1ZXN0KSByZXR1cm5zIChUcmFuc2ZlclJlc3BvbnNlKTsKICAgIHJwYyBHZXRCYWxhbmNlKEdldEJhbGFuY2VSZXF1ZXN0KSByZXR1cm5zIChHZXRCYWxhbmNlUmVzcG9uc2UpOyAvLyDmlrDlop4gR2V0QmFsYW5jZSBSUEMKfQoKc2VydmljZSBOb2RlTWFuYWdlclNlcnZpY2UgewogICAgcnBjIFJlZ2lzdGVyV29ya2VyTm9kZShSZWdpc3Rlcldvcmtlck5vZGVSZXF1ZXN0KSByZXR1cm5zIChTdGF0dXNSZXNwb25zZSk7CiAgICBycGMgSGVhbHRoQ2hlY2soSGVhbHRoQ2hlY2tSZXF1ZXN0KSByZXR1cm5zIChIZWFsdGhDaGVja1Jlc3BvbnNlKTsKICAgIHJwYyBSZXBvcnRTdGF0dXMoUmVwb3J0U3RhdHVzUmVxdWVzdCkgcmV0dXJucyAoU3RhdHVzUmVzcG9uc2UpOwogICAgcnBjIEdldE5vZGVMaXN0KEdldE5vZGVMaXN0UmVxdWVzdCkgcmV0dXJucyAoR2V0Tm9kZUxpc3RSZXNwb25zZSk7Cn0KCnNlcnZpY2UgTWFzdGVyTm9kZVNlcnZpY2UgewogICAgcnBjIFVwbG9hZFRhc2soVXBsb2FkVGFza1JlcXVlc3QpIHJldHVybnMgKFVwbG9hZFRhc2tSZXNwb25zZSk7CiAgICBycGMgUG9sbFRhc2tTdGF0dXMoUG9sbFRhc2tTdGF0dXNSZXF1ZXN0KSByZXR1cm5zIChQb2xsVGFza1N0YXR1c1Jlc3BvbnNlKTsKICAgIHJwYyBTdG9yZU91dHB1dChTdG9yZU91dHB1dFJlcXVlc3QpIHJldHVybnMgKFN0YXR1c1Jlc3BvbnNlKTsKICAgIHJwYyBTdG9yZVJlc3VsdChTdG9yZVJlc3VsdFJlcXVlc3QpIHJldHVybnMgKFN0YXR1c1Jlc3BvbnNlKTsKICAgIHJwYyBHZXRUYXNrUmVzdWx0KEdldFRhc2tSZXN1bHRSZXF1ZXN0KSByZXR1cm5zIChHZXRUYXNrUmVzdWx0UmVzcG9uc2UpOwogICAgcnBjIFRhc2tDb21wbGV0ZWQoVGFza0NvbXBsZXRlZFJlcXVlc3QpIHJldHVybnMgKFN0YXR1c1Jlc3BvbnNlKTsKICAgIHJwYyBTdG9yZUxvZ3MoU3RvcmVMb2dzUmVxdWVzdCkgcmV0dXJucyAoU3RhdHVzUmVzcG9uc2UpOwogICAgcnBjIEdldFRhc2tMb2dzKEdldFRhc2tMb2dzUmVxdWVzdCkgcmV0dXJucyAoR2V0VGFza0xvZ3NSZXNwb25zZSk7CiAgICBycGMgR2V0QWxsVGFza3MoR2V0QWxsVGFza3NSZXF1ZXN0KSByZXR1cm5zIChHZXRBbGxUYXNrc1Jlc3BvbnNlKTsKICAgIHJwYyBTdG9wVGFzayhTdG9wVGFza1JlcXVlc3QpIHJldHVybnMgKFN0b3BUYXNrUmVzcG9uc2UpOwogICAgcnBjIFJldHVyblRhc2tSZXN1bHQoUmV0dXJuVGFza1Jlc3VsdFJlcXVlc3QpIHJldHVybnMgKFJldHVyblRhc2tSZXN1bHRSZXNwb25zZSk7Cn0KCnNlcnZpY2UgV29ya2VyTm9kZVNlcnZpY2UgewogICAgcnBjIEV4ZWN1dGVUYXNrKEV4ZWN1dGVUYXNrUmVxdWVzdCkgcmV0dXJucyAoRXhlY3V0ZVRhc2tSZXNwb25zZSk7CiAgICBycGMgUmVwb3J0T3V0cHV0KFJlcG9ydE91dHB1dFJlcXVlc3QpIHJldHVybnMgKFN0YXR1c1Jlc3BvbnNlKTsKICAgIHJwYyBSZXBvcnRSdW5uaW5nU3RhdHVzKFJ1bm5pbmdTdGF0dXNSZXF1ZXN0KSByZXR1cm5zIChSdW5uaW5nU3RhdHVzUmVzcG9uc2UpOwogICAgcnBjIFN0b3BUYXNrRXhlY3V0aW9uKFN0b3BUYXNrRXhlY3V0aW9uUmVxdWVzdCkgcmV0dXJucyAoU3RvcFRhc2tFeGVjdXRpb25SZXNwb25zZSk7Cn0=
EOF_nodepool.proto
echo '🔧 建立 ./static/js/monitor.js ...'
base64 -d > "./static/js/monitor.js" << 'EOF_static/js/monitor.js'
JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQogICAgLy8g5YuV5oWL5qqi5risQVBJ5Zyw5Z2ADQogICAgY29uc3QgQVBJX0JBU0VfVVJMID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjsNCg0KICAgIC8vIOWIneWni+WMliBDaGFydC5qcyDlnJbooagNCiAgICBjb25zdCBjcHVDaGFydEN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcHVDaGFydCcpLmdldENvbnRleHQoJzJkJyk7DQogICAgY29uc3QgbWVtb3J5Q2hhcnRDdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVtb3J5Q2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgbGV0IGNwdUNoYXJ0ID0gbnVsbDsNCiAgICBsZXQgbWVtb3J5Q2hhcnQgPSBudWxsOw0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gQ2hhcnQuanMg5Yid5aeL5YyWIENQVSDlnJbooagNCiAgICAgICAgY3B1Q2hhcnQgPSBuZXcgQ2hhcnQoY3B1Q2hhcnRDdHgsIHsNCiAgICAgICAgICAgIHR5cGU6ICdsaW5lJywNCiAgICAgICAgICAgIGRhdGE6IHsgDQogICAgICAgICAgICAgICAgbGFiZWxzOiBbXSwgDQogICAgICAgICAgICAgICAgZGF0YXNldHM6IFt7IA0KICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NQVSDkvb/nlKjnjocgKCUpJywgDQogICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdLCANCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjNjM2NmYxJywNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSg5OSwgMTAyLCAyNDEsIDAuMSknLA0KICAgICAgICAgICAgICAgICAgICBmaWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICB0ZW5zaW9uOiAwLjQsDQogICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAzLA0KICAgICAgICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogJyM2MzY2ZjEnLA0KICAgICAgICAgICAgICAgICAgICBwb2ludEJvcmRlckNvbG9yOiAnI2ZmZmZmZicsDQogICAgICAgICAgICAgICAgICAgIHBvaW50Qm9yZGVyV2lkdGg6IDIsDQogICAgICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiA1LA0KICAgICAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA3DQogICAgICAgICAgICAgICAgfV0gDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb3B0aW9uczogeyANCiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLA0KICAgICAgICAgICAgICAgIGludGVyYWN0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbmRleCcNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNjYWxlczogeyANCiAgICAgICAgICAgICAgICAgICAgeDogeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICfmmYLplpMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzY0NzQ4YicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDogeyB3ZWlnaHQ6ICdib2xkJyB9DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAncmdiYSgxNDgsIDE2MywgMTg0LCAwLjEpJw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjNjQ3NDhiJw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCANCiAgICAgICAgICAgICAgICAgICAgeTogeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdDUFUg5L2/55So546HICglKScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjNjQ3NDhiJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7IHdlaWdodDogJ2JvbGQnIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGVkTWF4OiAxMDAsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdyZ2JhKDE0OCwgMTYzLCAxODQsIDAuMSknDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyM2NDc0OGInDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7DQogICAgICAgICAgICAgICAgICAgIGxlZ2VuZDogew0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAndG9wJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZVBvaW50U3R5bGU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMjAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjMWUyOTNiJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7IHdlaWdodDogJ2JvbGQnIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogew0KICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgxNSwgMjMsIDQyLCAwLjkpJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlQ29sb3I6ICcjZjFmNWY5JywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlDb2xvcjogJyNmMWY1ZjknLA0KICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjNjM2NmYxJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29ybmVyUmFkaXVzOiA4LA0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUNvbG9yczogZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gQ2hhcnQuanMg5Yid5aeL5YyW6KiY5oa26auU5ZyW6KGoDQogICAgICAgIG1lbW9yeUNoYXJ0ID0gbmV3IENoYXJ0KG1lbW9yeUNoYXJ0Q3R4LCB7DQogICAgICAgICAgICB0eXBlOiAnbGluZScsDQogICAgICAgICAgICBkYXRhOiB7IA0KICAgICAgICAgICAgICAgIGxhYmVsczogW10sIA0KICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBbeyANCiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICfoqJjmhrbpq5Tkvb/nlKjnjocgKCUpJywgDQogICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdLCANCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjOGI1Y2Y2JywNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgxMzksIDkyLCAyNDYsIDAuMSknLA0KICAgICAgICAgICAgICAgICAgICBmaWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICB0ZW5zaW9uOiAwLjQsDQogICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAzLA0KICAgICAgICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogJyM4YjVjZjYnLA0KICAgICAgICAgICAgICAgICAgICBwb2ludEJvcmRlckNvbG9yOiAnI2ZmZmZmZicsDQogICAgICAgICAgICAgICAgICAgIHBvaW50Qm9yZGVyV2lkdGg6IDIsDQogICAgICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiA1LA0KICAgICAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA3DQogICAgICAgICAgICAgICAgfV0gDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb3B0aW9uczogeyANCiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLA0KICAgICAgICAgICAgICAgIGludGVyYWN0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbmRleCcNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNjYWxlczogeyANCiAgICAgICAgICAgICAgICAgICAgeDogeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICfmmYLplpMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzY0NzQ4YicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDogeyB3ZWlnaHQ6ICdib2xkJyB9DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAncmdiYSgxNDgsIDE2MywgMTg0LCAwLjEpJw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjNjQ3NDhiJw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCANCiAgICAgICAgICAgICAgICAgICAgeTogeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICfoqJjmhrbpq5Tkvb/nlKjnjocgKCUpJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyM2NDc0OGInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQ6IHsgd2VpZ2h0OiAnYm9sZCcgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgDQogICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSwgDQogICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRNYXg6IDEwMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ3JnYmEoMTQ4LCAxNjMsIDE4NCwgMC4xKScNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICB0aWNrczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzY0NzQ4YicNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHBsdWdpbnM6IHsNCiAgICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICd0b3AnLA0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlUG9pbnRTdHlsZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAyMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyMxZTI5M2InLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQ6IHsgd2VpZ2h0OiAnYm9sZCcgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDE1LCAyMywgNDIsIDAuOSknLA0KICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVDb2xvcjogJyNmMWY1ZjknLA0KICAgICAgICAgICAgICAgICAgICAgICAgYm9keUNvbG9yOiAnI2YxZjVmOScsDQogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogJyM4YjVjZjYnLA0KICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsDQogICAgICAgICAgICAgICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDgsDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3JzOiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGNvbnNvbGUubG9nKCLlnJbooajliJ3lp4vljJbmiJDlip8iKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCLlnJbooajliJ3lp4vljJblpLHmlZc6IiwgZXJyb3IpOw0KICAgICAgICAkKCcuY2hhcnQtY29udGFpbmVyJykuaHRtbCgnPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1lcnJvciI+5ZyW6KGo5Yid5aeL5YyW5aSx5pWX77yM6KuL5qqi5p+l5o6n5Yi25Y+w5pel6KqM44CCPC9kaXY+Jyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdXBkYXRlU3RhdHVzKCkgew0KICAgICAgICAkLmdldChgJHtBUElfQkFTRV9VUkx9L2FwaS9zdGF0dXNgLCBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICBpZiAoZGF0YS5lcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGZyb20gL2FwaS9zdGF0dXM6IiwgZGF0YS5lcnJvcik7DQogICAgICAgICAgICAgICAgJCgnI3Rhc2stc3RhdHVzJykudGV4dCgnRXJyb3IgbG9hZGluZyBzdGF0dXMnKS5yZW1vdmVDbGFzcygpLmFkZENsYXNzKCdzdGF0dXMgZXJyb3InKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIOabtOaWsOeLgOaFi+mhr+ekug0KICAgICAgICAgICAgJCgnI25vZGUtaWQnKS50ZXh0KGRhdGEubm9kZV9pZCB8fCAnTi9BJyk7DQogICAgICAgICAgICAkKCcjdGFzay1pZCcpLnRleHQoZGF0YS5jdXJyZW50X3Rhc2tfaWQgfHwgJ05vbmUnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8g5pu05paw54uA5oWL5qiZ57Gk5qij5byPDQogICAgICAgICAgICBjb25zdCBzdGF0dXNFbGVtZW50ID0gJCgnI3Rhc2stc3RhdHVzJyk7DQogICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCAnSWRsZSc7DQogICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHQoc3RhdHVzKS5yZW1vdmVDbGFzcygpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoc3RhdHVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2lkbGUnKSkgew0KICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQuYWRkQ2xhc3MoJ3N0YXR1cyBpZGxlJyk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdydW5uaW5nJykgfHwgc3RhdHVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2V4ZWN1dGluZycpKSB7DQogICAgICAgICAgICAgICAgc3RhdHVzRWxlbWVudC5hZGRDbGFzcygnc3RhdHVzIHJ1bm5pbmcnKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2Vycm9yJykgfHwgc3RhdHVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2ZhaWxlZCcpKSB7DQogICAgICAgICAgICAgICAgc3RhdHVzRWxlbWVudC5hZGRDbGFzcygnc3RhdHVzIGVycm9yJyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQuYWRkQ2xhc3MoJ3N0YXR1cyBwZW5kaW5nJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICQoJyNpcC1hZGRyZXNzJykudGV4dChkYXRhLmlwIHx8ICdOL0EnKTsNCiAgICAgICAgICAgICQoJyNjcHQtYmFsYW5jZScpLnRleHQoZGF0YS5jcHRfYmFsYW5jZSB8fCAwKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgY3B1UGVyY2VudCA9IGRhdGEuY3B1X3BlcmNlbnQgfHwgMDsNCiAgICAgICAgICAgIGNvbnN0IG1lbW9yeVBlcmNlbnQgPSBkYXRhLm1lbW9yeV9wZXJjZW50IHx8IDA7DQogICAgICAgICAgICANCiAgICAgICAgICAgICQoJyNjcHUtdXNhZ2UnKS50ZXh0KGNwdVBlcmNlbnQgKyAnJScpOw0KICAgICAgICAgICAgJCgnI21lbW9yeS11c2FnZScpLnRleHQobWVtb3J5UGVyY2VudCArICclJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIOabtOaWsOizh+a6kOWNoeeJhw0KICAgICAgICAgICAgJCgnI2NwdS1tZXRyaWMnKS50ZXh0KGNwdVBlcmNlbnQgKyAnJScpOw0KICAgICAgICAgICAgJCgnI21lbW9yeS1tZXRyaWMnKS50ZXh0KG1lbW9yeVBlcmNlbnQgKyAnJScpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpOw0KDQogICAgICAgICAgICAvLyDmm7TmlrDlnJbooajmlbjmk5oNCiAgICAgICAgICAgIGlmIChjcHVDaGFydCAmJiBjcHVDaGFydC5kYXRhICYmIGNwdUNoYXJ0LmRhdGEubGFiZWxzKSB7DQogICAgICAgICAgICAgICAgY3B1Q2hhcnQuZGF0YS5sYWJlbHMucHVzaChub3cpOw0KICAgICAgICAgICAgICAgIGNwdUNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uZGF0YS5wdXNoKGNwdVBlcmNlbnQpOw0KDQogICAgICAgICAgICAgICAgaWYgKGNwdUNoYXJ0LmRhdGEubGFiZWxzLmxlbmd0aCA+IDIwKSB7DQogICAgICAgICAgICAgICAgICAgIGNwdUNoYXJ0LmRhdGEubGFiZWxzLnNoaWZ0KCk7DQogICAgICAgICAgICAgICAgICAgIGNwdUNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uZGF0YS5zaGlmdCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjcHVDaGFydC51cGRhdGUoJ25vbmUnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKG1lbW9yeUNoYXJ0ICYmIG1lbW9yeUNoYXJ0LmRhdGEgJiYgbWVtb3J5Q2hhcnQuZGF0YS5sYWJlbHMpIHsNCiAgICAgICAgICAgICAgICBtZW1vcnlDaGFydC5kYXRhLmxhYmVscy5wdXNoKG5vdyk7DQogICAgICAgICAgICAgICAgbWVtb3J5Q2hhcnQuZGF0YS5kYXRhc2V0c1swXS5kYXRhLnB1c2gobWVtb3J5UGVyY2VudCk7DQoNCiAgICAgICAgICAgICAgICBpZiAobWVtb3J5Q2hhcnQuZGF0YS5sYWJlbHMubGVuZ3RoID4gMjApIHsNCiAgICAgICAgICAgICAgICAgICAgbWVtb3J5Q2hhcnQuZGF0YS5sYWJlbHMuc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgbWVtb3J5Q2hhcnQuZGF0YS5kYXRhc2V0c1swXS5kYXRhLnNoaWZ0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1lbW9yeUNoYXJ0LnVwZGF0ZSgnbm9uZScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gZmV0Y2ggL2FwaS9zdGF0dXM6IiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgJCgnI3Rhc2stc3RhdHVzJykudGV4dCgnQ29ubmVjdGlvbiBFcnJvcicpLnJlbW92ZUNsYXNzKCkuYWRkQ2xhc3MoJ3N0YXR1cyBlcnJvcicpOw0KDQogICAgICAgICAgICBpZiAoanFYSFIuc3RhdHVzID09PSA0MDEpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIuacg+ipseW3sumBjuacn++8jDPnp5Llvozph43mlrDlsI7lkJHnmbvlhaXpoIHpnaIiKTsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvbG9naW4nOw0KICAgICAgICAgICAgICAgIH0sIDMwMDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVMb2dzKCkgew0KICAgICAgICAkLmdldChgJHtBUElfQkFTRV9VUkx9L2FwaS9sb2dzYCwgZnVuY3Rpb24oZGF0YSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coIuaXpeiqjOaVuOaTmjoiLCBkYXRhKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmcm9tIC9hcGkvbG9nczoiLCBkYXRhLmVycm9yKTsNCiAgICAgICAgICAgICAgICAkKCcjbG9ncycpLmh0bWwoYDxkaXYgY2xhc3M9InRleHQtZXJyb3IiPui8ieWFpeaXpeiqjOmMr+iqpDogJHtkYXRhLmVycm9yfTwvZGl2PmApOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgbG9nc0RpdiA9ICQoJyNsb2dzJyk7DQogICAgICAgICAgICBsb2dzRGl2LmVtcHR5KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChkYXRhLmxvZ3MgJiYgQXJyYXkuaXNBcnJheShkYXRhLmxvZ3MpKSB7DQogICAgICAgICAgICAgICAgaWYgKGRhdGEubG9ncy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nc0Rpdi5odG1sKCc8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciIgc3R5bGU9Im9wYWNpdHk6IDAuNzsiPuebruWJjeaykuacieaXpeiqjOiomOmMhDwvZGl2PicpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGRhdGEubG9ncy5mb3JFYWNoKGxvZyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2dFbnRyeSA9ICQoJzxkaXY+JykudGV4dChsb2cpLmFkZENsYXNzKCdsb2ctZW50cnknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ3NEaXYuYXBwZW5kKGxvZ0VudHJ5KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIC8vIOiHquWLlea7vuWLleWIsOW6lemDqA0KICAgICAgICAgICAgICAgICAgICBsb2dzRGl2LnNjcm9sbFRvcChsb2dzRGl2WzBdLnNjcm9sbEhlaWdodCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIuaXpeiqjOaVuOaTmuagvOW8j+eVsOW4uDoiLCBkYXRhKTsNCiAgICAgICAgICAgICAgICBsb2dzRGl2Lmh0bWwoJzxkaXYgY2xhc3M9InRleHQtd2FybmluZyI+5pyq5pS25Yiw5pyJ5pWI55qE5pel6KqM5pW45pOaPC9kaXY+Jyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gZmV0Y2ggL2FwaS9sb2dzOiIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKTsNCiAgICAgICAgICAgICQoJyNsb2dzJykuaHRtbChgPGRpdiBjbGFzcz0idGV4dC1lcnJvciI+6LyJ5YWl5pel6KqM6Yyv6KqkOiAke3RleHRTdGF0dXN9ICgke2pxWEhSLnN0YXR1c30pPC9kaXY+YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChqcVhIUi5zdGF0dXMgPT09IDQwMSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybigi5pyD6Kmx5bey6YGO5pyf77yMM+enkuW+jOmHjeaWsOWwjuWQkeeZu+WFpemggemdoiIpOw0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9sb2dpbic7DQogICAgICAgICAgICAgICAgfSwgMzAwMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8vIOWIneWni+WKoOi8iQ0KICAgIHVwZGF0ZVN0YXR1cygpOw0KICAgIHVwZGF0ZUxvZ3MoKTsNCiAgICANCiAgICAvLyDlrprmnJ/mm7TmlrANCiAgICBzZXRJbnRlcnZhbCh1cGRhdGVTdGF0dXMsIDMwMDApOyAgLy8g5q+PM+enkuabtOaWsOeLgOaFiw0KICAgIHNldEludGVydmFsKHVwZGF0ZUxvZ3MsIDUwMDApOyAgICAvLyDmr48156eS5pu05paw5pel6KqMDQoNCiAgICAvLyDlhajlsYDlh73mlbgNCiAgICB3aW5kb3cucmVmcmVzaFN0YXR1cyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBjb25zb2xlLmxvZygi5omL5YuV5Yi35paw54uA5oWLIik7DQogICAgICAgIHVwZGF0ZVN0YXR1cygpOw0KICAgIH0NCg0KICAgIHdpbmRvdy5yZWZyZXNoTG9ncyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBjb25zb2xlLmxvZygi5omL5YuV5Yi35paw5pel6KqMIik7DQogICAgICAgIHVwZGF0ZUxvZ3MoKTsNCiAgICB9DQp9KTs=
EOF_static/js/monitor.js
echo '🐍 建立虛擬環境...'
python3 -m venv venv
source venv/bin/activate
echo '📦 安裝依賴...'
pip install --upgrade pip
pip install -r requirements.txt
python3 -m grpc_tools.protoc --proto_path=. --python_out=. --grpc_python_out=. nodepool.proto
sudo apt install wireguard
echo '🐳 檢查是否已安裝 Docker...'
if ! command -v docker &> /dev/null; then
    echo '📦 Docker 未安裝，正在安裝...'
    curl -fsSL https://get.docker.com -o get-docker.sh
    sudo sh get-docker.sh
    sudo systemctl start docker
    sudo systemctl enable docker
else
    echo '✅ Docker 已安裝，略過安裝步驟。'
fi
echo '🚀 啟動 worker_node.py...'
python3 worker_node.py